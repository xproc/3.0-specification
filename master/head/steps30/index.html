<html xmlns="http://www.w3.org/1999/xhtml"><head><title>XProc 3.0: Standard Step Library</title><meta charset="utf-8" /><link rel="alternate" title="XML" href="steps30.xml" /><link rel="alternate" title="Latest editor's draft" href="http://www.w3.org/XML/XProc/docs/langspec.html" /><link rel="alternate" title="Latest Public Working Draft" href="http://www.w3.org/TR/xproc/" /><meta name="generator" content="DocBook XSL 2.0 Stylesheets V2.0.20" /><link rel="stylesheet" type="text/css" href="base.css" /><link rel="stylesheet" type="text/css" href="xproc.css" /><link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/base.css" /><link rel="stylesheet" type="text/css" href="base.css" /><script type="text/javascript" src="http://cdn.docbook.org/release/2.0.20/resources/js/dbmodnizr.js"></script><link href="http://cdn.docbook.org/release/2.0.20/resources/css/prism.css" rel="stylesheet" type="text/css" /><link href="http://cdn.docbook.org/release/2.0.20/resources/css/db-prism.css" rel="stylesheet" type="text/css" /></head><body><div class="specification"><div class="head" id="spec.head"><h1>XProc 3.0: Standard Step Library</h1><h2>Editor's Draft  <time datetime="2017-09-26T07:21:02Z">26 September 2017 at 07:21 UTC (<a href="https://github.com/xproc/3.0-specification/commit/934489b0ceb7e95ed41ec1d406bf664eca45ccf0">build 66</a>)</time></h2><dl><dt>This Version:</dt><dd><a href="https://xproc.github.io/3.0-specification/master/head/steps30/">https://xproc.github.io/3.0-specification/master/head/steps30</a></dd><dt>Latest Version:</dt><dd><a href="http://spec.xproc.org/master/head/steps30/">http://spec.xproc.org/master/head/steps30/</a></dd><dt>Editors:</dt><dd><span class="personname">Achim Berndzen</span></dd><dd><span class="personname">Gerrit Imsieke</span></dd><dd><span class="personname">Norman Walsh</span></dd><dt>Repository:</dt><dd><a href="http://github.com/xproc/3.0-specification">This specification on GitHub</a></dd><dd><a href="http://github.com/xproc/3.0-specification/issues">Report an issue</a></dd><dt>Changes:</dt><dd><a href="http://github.com/xproc/3.0-specification/commits/master">Commits for this specification</a></dd></dl><p>This document is also available in these non-normative formats: <a href="steps30.xml">XML</a>.</p><p class="copyright">Copyright © 2016 FIXME:</p><hr /><div class="abstract"><h2>Abstract</h2>
  <p>This specification describes the standard step vocabulary of
  <em class="citetitle">XProc 3.0: An XML Pipeline Language</em>.</p>
</div><div class="status"><h2>Status of this Document</h2><p><strong>This document is an editor's  draft that has no official standing.</strong></p>

<p><em>This section describes the status of this document at
the time of its publication. Other documents may supersede this
document.</em></p>

<p>This document is derived from
<a href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc:
An XML Pipeline Language</a> published by the W3C. See also
<a href="#credits" title="Credits">Appendix B, <i>Credits</i></a>.</p>
</div></div><hr /><div class="lists-of-titles"><div class="toc"><h2 id="TableOfContents">Table of Contents</h2><ul class="toc"><li><span>1 <a href="#introduction">Introduction</a></span><ul class="toc"><li><span>1.1 <a href="#std-required">Required Steps</a></span><ul class="toc"><li><span>1.1.1 <a href="#c.add-attribute">p:add-attribute</a></span></li><li><span>1.1.2 <a href="#c.add-xml-base">p:add-xml-base</a></span></li><li><span>1.1.3 <a href="#c.cast-content-type">p:cast-content-type</a></span></li><li><span>1.1.4 <a href="#c.compare">p:compare</a></span></li><li><span>1.1.5 <a href="#c.count">p:count</a></span></li><li><span>1.1.6 <a href="#c.delete">p:delete</a></span></li><li><span>1.1.7 <a href="#c.directory-list">p:directory-list</a></span></li><li><span>1.1.8 <a href="#c.error">p:error</a></span></li><li><span>1.1.9 <a href="#c.escape-markup">p:escape-markup</a></span></li><li><span>1.1.10 <a href="#c.filter">p:filter</a></span></li><li><span>1.1.11 <a href="#c.http-request">p:http-request</a></span></li><li><span>1.1.12 <a href="#c.identity">p:identity</a></span></li><li><span>1.1.13 <a href="#c.insert">p:insert</a></span></li><li><span>1.1.14 <a href="#c.label-elements">p:label-elements</a></span></li><li><span>1.1.15 <a href="#c.load">p:load</a></span></li><li><span>1.1.16 <a href="#c.make-absolute-uris">p:make-absolute-uris</a></span></li><li><span>1.1.17 <a href="#c.namespace-rename">p:namespace-rename</a></span></li><li><span>1.1.18 <a href="#c.pack">p:pack</a></span></li><li><span>1.1.19 <a href="#c.parameters">p:parameters</a></span></li><li><span>1.1.20 <a href="#c.rename">p:rename</a></span></li><li><span>1.1.21 <a href="#c.replace">p:replace</a></span></li><li><span>1.1.22 <a href="#c.set-attributes">p:set-attributes</a></span></li><li><span>1.1.23 <a href="#c.set-properties">p:set-properties</a></span></li><li><span>1.1.24 <a href="#c.sink">p:sink</a></span></li><li><span>1.1.25 <a href="#c.split-sequence">p:split-sequence</a></span></li><li><span>1.1.26 <a href="#c.store">p:store</a></span></li><li><span>1.1.27 <a href="#c.string-replace">p:string-replace</a></span></li><li><span>1.1.28 <a href="#c.unescape-markup">p:unescape-markup</a></span></li><li><span>1.1.29 <a href="#c.unwrap">p:unwrap</a></span></li><li><span>1.1.30 <a href="#c.wrap">p:wrap</a></span></li><li><span>1.1.31 <a href="#c.wrap-sequence">p:wrap-sequence</a></span></li><li><span>1.1.32 <a href="#c.xinclude">p:xinclude</a></span></li><li><span>1.1.33 <a href="#c.xslt">p:xslt</a></span></li></ul></li><li><span>1.2 <a href="#std-optional">Optional Steps</a></span><ul class="toc"><li><span>1.2.1 <a href="#c.exec">p:exec</a></span></li><li><span>1.2.2 <a href="#c.hash">p:hash</a></span></li><li><span>1.2.3 <a href="#c.in-scope-names">p:in-scope-names</a></span></li><li><span>1.2.4 <a href="#c.template">p:template</a></span></li><li><span>1.2.5 <a href="#c.uuid">p:uuid</a></span></li><li><span>1.2.6 <a href="#c.validate-with-relax-ng">p:validate-with-relax-ng</a></span></li><li><span>1.2.7 <a href="#c.validate-with-schematron">p:validate-with-schematron</a></span></li><li><span>1.2.8 <a href="#c.validate-with-xml-schema">p:validate-with-xml-schema</a></span></li><li><span>1.2.9 <a href="#c.www-form-urldecode">p:www-form-urldecode</a></span></li><li><span>1.2.10 <a href="#c.www-form-urlencode">p:www-form-urlencode</a></span></li><li><span>1.2.11 <a href="#c.xquery">p:xquery</a></span></li><li><span>1.2.12 <a href="#c.xsl-formatter">p:xsl-formatter</a></span></li></ul></li><li><span>1.3 <a href="#serialization-options">Serialization Options</a></span></li></ul></li><li><span>2 <a href="#errors">Errors</a></span><ul class="toc"><li><span>2.1 <a href="#static-errors">Static Errors</a></span></li><li><span>2.2 <a href="#dynamic-errors">Dynamic Errors</a></span></li><li><span>2.3 <a href="#step-errors">Step Errors</a></span></li></ul></li><li><span>A <a href="#app.step-errors">Step Errors</a></span></li><li><span>B <a href="#credits">Credits</a></span></li><li><span>C <a href="#references">References</a></span><ul class="toc"><li><span>1 <a href="#normative-references">Normative References</a></span></li><li><span>2 <a href="#informative-references">Informative References</a></span></li></ul></li></ul></div></div>


<section id="introduction" class="section"><div class="section-titlepage"><h2>1 Introduction</h2></div>
  

<p>This specification describes the standard, atomic XProc steps of
[<a href="#xproc20"><span class="abbrev">XProc 2.0</span></a>].

</p>

<p>Some aspects of documents are generally unchanged by steps:</p>

<div class="itemizedlist">


<ul><li>
<p>When a step in this library produces an output document,
the base URI of the output is the base URI of the step's primary
input document unless the step's process explicitly sets an
<code class="tag-attribute">xml:base</code> attribute or the step's
description explicitly states how the base URI is constructed.</p>
</li><li>
<p>Unless otherwise specified, steps in this library do not
modify the <em class="glossterm"><a href="../xproc30/#dt-document-properties">document properties</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> of the documents
that flow through them.</p>
</li></ul></div>

<p id="cv.result">Also, in this specification, several steps use this
element for result information:</p>

<p id="d402e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:result&gt;<br />    <var>string</var><br />&lt;/c:result&gt;</code></p>

<p>When a step uses an XPath to compute an option value, the XPath
context is as defined in
<span class="xspecref"><a href="../xproc30/#xpath-context">Section 2.7, “XPaths in XProc”</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>.</p>

<p>When a step specifies a particular version of a technology,
implementations <span class="rfc2119" id="introduction.8.1">must</span> implement that
version or a subsequent version that is backwards compatible with that
version. At user-option, they may implement other non-backwards
compatible versions.</p>

<section id="std-required" class="section"><div class="section-titlepage"><h3>1.1 Required Steps</h3></div>


<p>This section describes standard steps that must be supported
by any conforming processor.</p>

<section id="c.add-attribute" class="section"><div class="section-titlepage"><h4>1.1.1 p:add-attribute</h4></div>


<p>The <code class="code">p:add-attribute</code> step adds a single attribute to
a set of matching elements. The input document specified on the
<code class="code">source</code> is processed for matches specified by the match
pattern in the <code class="option">match</code> option. For each of these
matches, the attribute whose name is specified by the
<code class="option">attribute-name</code> option is set to the attribute value
specified by the <code class="option">attribute-value</code> option.
</p>

<p>The resulting document is produced on the <code class="code">result</code>
output port and consists of a exact copy of the input with the
exception of the matched elements. Each of the matched elements is
copied to the output with the addition of the specified attribute
with the specified value.
</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:add-attribute</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-name</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-value</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option
<span class="rfc2119" id="c.add-attribute.5.2">must</span> be an XSLTMatchPattern. <a id="err.inline.C0023"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the match pattern does
not match an element.</p>

<p>The value of the <code class="option">attribute-name</code> option
<span class="rfc2119" id="c.add-attribute.6.2">must</span> be a <code class="type">QName</code>.
If the lexical value does not contain a colon, then the <code class="tag-attribute">attribute-namespace</code> may be used to specify the
namespace of the attribute. In that case, the <code class="tag-attribute">attribute-prefix</code> may be specified to suggest a
prefix for the attribute name. <a id="err.inline.D0034"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) to specify a new namespace or
prefix if the lexical value of the specified name contains a
colon.
The corresponding expanded name is used to construct the attribute.</p>

<p>The value of the <code class="option">attribute-value</code> option
<span class="rfc2119" id="c.add-attribute.7.2">must</span> be a legal attribute value according to XML.</p>

<p>If an attribute with the same name as the expanded name
from the <code class="option">attribute-name</code> option exists on the matched
element, the value specified in
the <code class="option">attribute-value</code> option is used to set the
value of that existing attribute.  That is, the value of the
existing attribute is changed to the <code class="option">attribute-value</code>
value. </p>

<div id="note-multattr" class="note admonition"><h3>Note</h3><div class="admonition-body"><p>If multiple attributes need to be set on the same
element(s), the <a href="#c.set-attributes"><code class="tag-element">p:set-attributes</code></a> step can be used to set them
all at once.</p>
</div></div>

<p>This step cannot be used to add namespace declarations. <a id="err.inline.C0059"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0059"><code class="errqname">err:XC0059</code></a>) if the QName
value in the <code class="option">attribute-name</code> option uses the prefix
“<code class="literal">xmlns</code>”
or any other prefix that resolves to the namespace name
<code class="uri">http://www.w3.org/2000/xmlns/</code>.
 Note, however, that while namespace declarations cannot be
added explicitly by this step, adding an attribute whose name is in a
namespace for which there is no namespace declaration in scope on the
matched element may result in a namespace binding being added by
<span class="xspecref"><a href="../xproc30/#namespace-fixup">Section 2.5.2, “Namespace Fixup on XML Outputs”</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>.</p>

<p>If an attribute named
<code class="tag-attribute">xml:base</code> is added or changed, the base URI
of the element <span class="rfc2119" id="c.add-attribute.11.2">must</span> also be amended accordingly.</p>

</section>
<section id="c.add-xml-base" class="section"><div class="section-titlepage"><h4>1.1.2 p:add-xml-base</h4></div>



<p>The <code class="code">p:add-xml-base</code> step exposes the base URI via
explicit <code class="code">xml:base</code> attributes. The input document from the
<code class="port">source</code> port is replicated to the <code class="port">result</code> port
with <code class="code">xml:base</code> attributes added to or corrected on each element as specified
by the options on this step.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:add-xml-base</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">all</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">relative</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>   </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

 <p>The value of the <code class="option">all</code> option
<span class="rfc2119" id="c.add-xml-base.4.2">must</span> be a boolean.</p>

 <p>The value of the <code class="option">relative</code> option
<span class="rfc2119" id="c.add-xml-base.5.2">must</span> be a boolean.</p>

<p><a id="err.inline.C0058"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0058"><code class="errqname">err:XC0058</code></a>)
if the <code class="option">all</code> and <code class="option">relative</code> options are
<em>both</em> <code class="literal">true</code>.</p>

<p>The <code class="tag-element">p:add-xml-base</code> step modifies its input as follows:</p>

<div class="itemizedlist">


<ul><li>
<p>For the document element: force the element to have an <code class="tag-attribute">xml:base</code>
attribute with the document's [base URI] property's value as its value.</p>
</li><li>
<p>For other elements:</p>
<div class="itemizedlist">



<ul><li>
<p>If the <code class="option">all</code> option has the value
<code class="literal">true</code>, force the element to have an <code class="tag-attribute">xml:base</code> attribute with the element's [base
URI] value as its value.</p>
</li><li>
<p>If the element's [base URI] is different from the its parent's
[base URI], force the element to have an <code class="tag-attribute">xml:base</code> attribute with the following
value: if the value of the <code class="option">relative</code> option is
<code class="literal">true</code>, a string which, when resolved against the
parent's [base URI], will give the element's [base URI], otherwise the
element's [base URI].</p>
</li><li>
<p>Otherwise, if there is an <code class="tag-attribute">xml:base</code> attribute present, remove it.
</p>
</li></ul></div>
</li></ul></div>
</section>
<section id="c.cast-content-type" class="section"><div class="section-titlepage"><h4>1.1.3 p:cast-content-type</h4></div>


<p>The <code class="tag-element">p:cast-content-type</code> step changes the media type
of its input.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:cast-content-type</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">content-type</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The input document is transformed from one media type to another.
<a id="err.inline.C1002"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1002"><code class="errqname">err:XC1002</code></a>) if the supplied <code class="option">content-type</code> is not
a valid media type of the form
“<code class="literal"><em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>subtype</code></em>+<em class="replaceable"><code>ext</code></em></code>”.</p>

<div class="itemizedlist">




<ul><li>
<p>Casting from one XML media type to another simply changes the
“<code class="literal">content-type</code>” <em class="glossterm"><a href="../xproc30/#dt-document-properties">document
property</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.
</p>
</li><li id="c.data">
<p>Casting from a non-XML media type to an XML media type produces an
XML document with a <a href="#c.data"><code class="tag-element">c:data</code></a> document element. The original
media type will be preserved in the
<code class="tag-attribute">content-type</code> attribute on the
<a href="#c.data"><code class="tag-element">c:data</code></a> element.</p>

<p id="d505e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:data<br />  <strong>content-type</strong> = <var>ContentType</var><br />  charset? = <var>string</var><br />  encoding? = <var>string</var>&gt;<br />    <var>string</var><br />&lt;/c:data&gt;</code></p>

<p>The content of the <a href="#c.data"><code class="tag-element">c:data</code></a> element is the base64 encoded
representation of the non-XML content.</p>
</li><li>
<p>Casting from an XML media type to a non-XML media type
<span class="rfc2119" id="c.cast-content-type.5.3.1.1">must</span> support the case where the input document is
a <a href="#c.data"><code class="tag-element">c:data</code></a> document. The resulting document will
have the specified media type and a <em class="glossterm"><a href="../xproc30/#dt-representation">representation</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> that
is the content of the <a href="#c.data"><code class="tag-element">c:data</code></a> element after decoding the base64
encoded content.</p>
<p><a id="err.inline.C1004"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1004"><code class="errqname">err:XC1004</code></a>) if the <a href="#c.data"><code class="tag-element">c:data</code></a> contains content is not
a valid base64 string.</p>
<p><a id="err.inline.C1005"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1005"><code class="errqname">err:XC1005</code></a>) if the <a href="#c.data"><code class="tag-element">c:data</code></a> element does not have
a <code class="tag-attribute">content-type</code> attribute.</p>
<p><a id="err.inline.C1006"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1006"><code class="errqname">err:XC1006</code></a>) if the <code class="option">content-type</code> is supplied and is
not the same as the <code class="tag-attribute">content-type</code> specified on
the <a href="#c.data"><code class="tag-element">c:data</code></a> element.
</p>
<p><span id="impl-1">Casting from an XML media type to a non-XML media type when
the input document is not a <a href="#c.data"><code class="tag-element">c:data</code></a> document is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>
</li><li>
<p><span id="impl-2">What happens when one non-XML media type is cast to another
non-XML media type is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
<a id="err.inline.C1003"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1003"><code class="errqname">err:XC1003</code></a>) if the <code class="tag-element">p:cast-content-type</code> step
cannot perform the requested cast.</p>
</li></ul></div>

<p><a id="err.inline.C1007"></a>In all cases except when the input document
is a <a href="#c.data"><code class="tag-element">c:data</code></a> element, it is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1007"><code class="errqname">err:XC1007</code></a>) if the <code class="option">content-type</code> is not supplied.
</p>
</section>
<section id="c.compare" class="section"><div class="section-titlepage"><h4>1.1.4 p:compare</h4></div>


<p>The <code class="code">p:compare</code> step compares two documents for
equality.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:compare</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">alternate</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">fail-if-not-equal</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">fail-if-not-equal</code> option
<span class="rfc2119" id="c.compare.4.2">must</span> be a boolean.</p>

<p>This step takes single documents on each of two ports and
compares them. If both media types are XML media types, the comparison
uses <code class="function">fn:deep-equal</code> (as defined in [<a href="#xpath-functions"><span class="abbrev">XPath 2.0 Functions and Operators</span></a>]). <span id="impl-3">In <code class="tag-element">p:compare</code>, if either
media type is not an XML media type, the result is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p><a id="err.inline.C0019"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0019"><code class="errqname">err:XC0019</code></a>)
if the documents are not equal, and the value of the
<code class="option">fail-if-not-equal</code> option is
<code class="literal">true</code>. If the documents are equal, or if the
value of the <code class="option">fail-if-not-equal</code> option is
<code class="literal">false</code>, a <a href="#cv.result"><code class="tag-element">c:result</code></a> document is produced
with contents <code class="literal">true</code> if the documents are equal,
otherwise <code class="literal">false</code>.</p>

</section>
<section id="c.count" class="section"><div class="section-titlepage"><h4>1.1.5 p:count</h4></div>


<p>The <code class="code">p:count</code> step counts the number of documents in
the <code class="code">source</code> input sequence and returns a single document
on <code class="code">result</code> containing that number. The generated document
contains a single <a href="#cv.result"><code class="tag-element">c:result</code></a> element whose contents is the
string representation of the number of documents in the
sequence.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:count</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">limit</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">0</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer</code><code>"</code><code>/&gt;</code><code>           </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>If the <code class="tag-attribute">limit</code> option is specified
and is greater than zero, the <code class="tag-element">p:count</code> step will count at most
that many documents. This provides a convenient mechanism to discover,
for example, if a sequence consists of more than 1 document, without
requiring every single document to be buffered before processing can
continue.</p>
</section>
<section id="c.delete" class="section"><div class="section-titlepage"><h4>1.1.6 p:delete</h4></div>


<p>The <code class="code">p:delete</code> step deletes items specified by a match
pattern from the
<code class="code">source</code> input document and produces the resulting document,
with the deleted items removed, on the <code class="port">result</code> port.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:delete</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.delete.4.2">must</span> be an
XSLTMatchPattern. A match pattern may match multiple items to be
deleted.</p>

<p>If an element is selected by the <code class="option">match</code> option, the
entire subtree rooted at that element is deleted.</p>

<p>This step cannot be used to remove namespaces. <a id="err.inline.C0062"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0062"><code class="errqname">err:XC0062</code></a>) if the
<code class="option">match</code> option matches a namespace node.
Also, note that deleting an attribute named
<code class="tag-attribute">xml:base</code> does not change the base URI
of the element on which it occurred.</p>

</section>
<section id="c.directory-list" class="section"><div class="section-titlepage"><h4>1.1.7 p:directory-list</h4></div>


<p>The <code class="code">p:directory-list</code> step produces a list of the
contents of a specified
directory.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:directory-list</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-type-attr">content-type</code><code>="</code><code class="value content-type-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">path</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-filter</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code><code class="comment">&lt;!-- </code><span class="opt-type">RegularExpression</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">exclude-filter</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code><code class="comment">&lt;!-- </code><span class="opt-type">RegularExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">path</code> option
<span class="rfc2119" id="c.directory-list.4.2">must</span> be an <code class="type">anyURI</code>. It is interpreted
as an IRI reference. If it is relative, it is made absolute against
the base URI of the element on which it is specified
(<a href="../xproc30/#p.with-option">p:with-option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> or <code class="tag-element">p:directory-list</code> in the case of a
<span class="xspecref"><a href="../xproc30/#option-shortcut">syntactic shortcut</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span> value).</p>

<p><a id="err.inline.C0017"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0017"><code class="errqname">err:XC0017</code></a>) if the absolute path does not
identify a directory. <a id="err.inline.C0012"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0012"><code class="errqname">err:XC0012</code></a>) if the contents of the directory
path are not available to the step due to access restrictions in the
environment in which the pipeline is run.</p>

<p><span id="impl-4">Conformant processors <span class="rfc2119" id="c.directory-list.6.1.1">must</span> support directory paths whose
scheme is <code class="code">file</code>. It is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> what other schemes are
supported by <code class="tag-element">p:directory-list</code>, and what the interpretation
of 'directory', 'file' and 'contents' is for those schemes.</span>
</p>

<p>If present, the value of the <code class="option">include-filter</code>
or <code class="option">exclude-filter</code>
option <span class="rfc2119" id="c.directory-list.7.3">must</span> be a regular expression as specified in [<a href="#xpath-functions"><span class="abbrev">XPath 2.0 Functions and Operators</span></a>], section 7.61 “<code class="literal">Regular Expression
Syntax</code>”.</p>

<p>If the <code class="option">include-filter</code> pattern matches a
directory entry's name, the entry is included in the output. If the
<code class="option">exclude-filter</code> pattern matches a directory entry's name,
the entry is excluded in the output. If both options are provided, the
include filter is processed first, then the exclude filter.</p>

<p id="cv.directory">The result document produced for
the specified directory path has a <a href="#cv.directory"><code class="tag-element">c:directory</code></a> document
element whose base URI is the directory path and whose
<code class="tag-attribute">name</code> attribute is the last segment
of the directory path (that is, the directory's (local) name).</p>

<p id="d591e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:directory<br />  <strong>name</strong> = <var>string</var>&gt;<br />    (<a href="#cv.file">c:file</a> | <br />     <a href="#cv.directory">c:directory</a> | <br />     <a href="#cv.other">c:other</a>)*<br />&lt;/c:directory&gt;</code></p>

<p>Its contents are determined as follows, based on the entries in
the directory identified by the directory path. For each entry in the
directory, if either no <code class="option">filter</code> was specified, or the
(local) name of the entry matches the filter pattern, a
<a href="#cv.file"><code class="tag-element">c:file</code></a>, a <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or a <a href="#cv.other"><code class="tag-element">c:other</code></a>
element is produced, as follows:
</p>

<div class="itemizedlist">



<ul><li>
<p>A <a href="#cv.directory"><code class="tag-element">c:directory</code></a> is produced for each subdirectory not
determined to be special.</p>
</li><li>
<p id="cv.file">A <a href="#cv.file"><code class="tag-element">c:file</code></a> is produced for each file
not determined to be special.</p>
<p id="d600e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:file<br />  <strong>name</strong> = <var>string</var> /&gt;</code></p>
</li><li>
<p id="cv.other"><span id="impl-5">Any file or directory determined to be
special by the <code class="tag-element">p:directory-list</code> step may be output using a
<a href="#cv.other"><code class="tag-element">c:other</code></a> element but the criteria for marking a file as
special are <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>
<p id="d604e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:other<br />  <strong>name</strong> = <var>string</var> /&gt;</code></p>
</li></ul></div>

<p>When a directory entry is a subdirectory, that directory's entries are not
output as part of that entry's <a href="#cv.directory"><code class="tag-element">c:directory</code></a>.  A user must apply this step
again to the subdirectory to list subdirectory contents.</p>

<p>Each of the elements <a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>,
and <a href="#cv.other"><code class="tag-element">c:other</code></a> has a <code class="code">name</code> attribute when it
appears within the top-level <a href="#cv.directory"><code class="tag-element">c:directory</code></a> element, whose
value is a relative IRI reference, giving the (local) file or
directory name.</p>

<p><span id="impl-6">Any attributes other than <code class="tag-attribute">name</code> on
<a href="#cv.file"><code class="tag-element">c:file</code></a>, <a href="#cv.directory"><code class="tag-element">c:directory</code></a>, or <a href="#cv.other"><code class="tag-element">c:other</code></a>
are <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

</section>
<section id="c.error" class="section"><div class="section-titlepage"><h4>1.1.8 p:error</h4></div>


<p>The <code class="code">p:error</code> step generates a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> using the input provided
to the step.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:error</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">code</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">code-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>                 </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">code-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>              </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">code</code> option
<span class="rfc2119" id="c.error.4.2">must</span> be a <code class="type">QName</code>.
If the lexical value does not contain a colon, then the <code class="tag-attribute">code-namespace</code> may be used to specify the
namespace of the code. In that case, the <code class="tag-attribute">code-prefix</code> may be specified to suggest a
prefix for the code. <a id="err.inline.D0034.1"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) to specify a new namespace or
prefix if the lexical value of the specified name contains a
colon.</p>

<p>This step uses the document provided on its input as the content
of the error raised. An instance of the
<a href="../xproc30/#cv.errors">c:errors</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> element will be produced on the error output port, as is
always the case for <em class="glossterm"><a href="#dt-dynamic-error">dynamic errors</a></em>.
The error generated can be caught by a <a href="../xproc30/#p.try">p:try</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> just like any
other dynamic error.</p>

<p>For authoring convenience, the <code class="tag-element">p:error</code> step is
declared with a single, primary output port. With respect to
<em class="glossterm"><a href="../xproc30/#dt-connection">connections</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>, this port behaves like
any other output port even though nothing can ever
appear on it since the step always fails.</p>

<p>For example, given the following invocation:</p>
<pre class="programlisting language-markup line-numbers"><code>&lt;p:error xmlns:my="http://www.example.org/error"
         name="bad-document" code="my:unk12"&gt;
   &lt;p:input port="source"&gt;
     &lt;p:inline&gt;
       &lt;message&gt;The document element is unknown.&lt;/message&gt;
     &lt;/p:inline&gt;
   &lt;/p:input&gt;
&lt;/p:error&gt;</code></pre>

<p>The error vocabulary element (and document) generated on the
error output port would be:</p>
<pre class="programlisting language-markup line-numbers"><code>&lt;c:errors xmlns:c="http://www.w3.org/ns/xproc-step"
          xmlns:p="http://www.w3.org/ns/xproc"
          xmlns:my="http://www.example.org/error"&gt;
 &lt;c:error name="bad-document" type="p:error"
          code="my:unk12"&gt;&lt;message&gt;The document element is unknown.&lt;/message&gt;
&lt;/c:error&gt;
&lt;/c:errors&gt;</code></pre>

<p>The <code class="tag-attribute">href</code>,
<code class="tag-attribute">line</code> and <code class="tag-attribute">column</code>,
or <code class="tag-attribute">offset</code>, might also be present on the
<code class="tag-element">c:error</code> to identify the location of the <code class="tag-element">p:error</code>
element in the pipeline.</p>

</section>
<section id="c.escape-markup" class="section"><div class="section-titlepage"><h4>1.1.9 p:escape-markup</h4></div>


<p>The <code class="code">p:escape-markup</code> step applies XML serialization to the
children of the document element and replaces those children with their
serialization. The outcome is a single element with text content that
represents the "escaped" syntax of the children as they were
serialized.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:escape-markup</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">cdata-section-elements</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">''</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">ListOfQNames</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-public</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-system</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">escape-uri-attributes</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-content-type</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">indent</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">media-type</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">method</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'xml'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">omit-xml-declaration</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">standalone</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'omit'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>   </code><code class="comment">&lt;!-- </code><span class="opt-type">"true" | "false" | "omit"</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">undeclare-prefixes</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'1.0'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>This step supports the standard serialization options as specified in <a href="#serialization-options" title="Serialization Options">Section 1.3, “Serialization Options”</a>.  These
options control how the output markup is produced before it is escaped.
</p>

<p>For example, the input:</p>
<pre class="programlisting language-markup line-numbers"><code>&lt;description&gt;
&lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;p&gt;This is a chunk of XHTML.&lt;/p&gt;
&lt;/div&gt;
&lt;/description&gt;</code></pre>
<p>produces:</p>
<pre class="programlisting language-markup line-numbers"><code>&lt;description&gt;
&amp;lt;div xmlns="http://www.w3.org/1999/xhtml"&amp;gt;
&amp;lt;p&gt;This is a chunk of XHTML.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&lt;/description&gt;</code></pre>

<div id="note-escaped" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>The result of this step is an XML document that contains the
Unicode characters that are the characters that result from escaping
the input. It is not encoded characters in a serialized octet stream,
therefore, the serialization options related to encoding characters
(<code class="option">byte-order-mark</code>, <code class="option">encoding</code>, and
<code class="option">normalization-form</code>) do not apply. They are omitted
from the standard serialization options on this step.</p>
</div></div>

<p>By default, this step <span class="rfc2119" id="c.escape-markup.10.1">must not</span> generate an
XML declaration in the escaped result.</p>

</section>
<section id="c.filter" class="section"><div class="section-titlepage"><h4>1.1.10 p:filter</h4></div>


<p>The <code class="code">p:filter</code> step selects portions of the source document
based on a (possibly dynamically constructed) XPath select expression.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:filter</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">select</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>This step behaves just like an <a href="../xproc30/#p.input">p:input</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> with
a <code class="tag-attribute">select</code> expression except that the select
expression is computed dynamically.</p>

</section>
<section id="c.http-request" class="section"><div class="section-titlepage"><h4>1.1.11 p:http-request</h4></div>


<p>The <code class="code">p:http-request</code> step provides for interaction
with resources over HTTP or related protocols.
The input
document provided on the <code class="port">source</code> port specifies a request
by a single <a href="#cv.request"><code class="tag-element">c:request</code></a> element. This element specifies
the method, resource, and other request properties as well as possibly
including an entity body (content) for the request.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:http-request</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">byte-order-mark</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">cdata-section-elements</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">''</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">ListOfQNames</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-public</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-system</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">encoding</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">escape-uri-attributes</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-content-type</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">indent</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">media-type</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">method</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'xml'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">normalization-form</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'none'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">NormalizationForm</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">omit-xml-declaration</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">standalone</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'omit'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>   </code><code class="comment">&lt;!-- </code><span class="opt-type">"true" | "false" | "omit"</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">undeclare-prefixes</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'1.0'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The standard serialization options are provided to control the
serialization of any XML content which is sent as part of the request.
The effect of these options is as specified in <a href="#serialization-options" title="Serialization Options">Section 1.3, “Serialization Options”</a>. See <a href="#c.request_body" title="Request Entity body conversion">Section 1.1.11.3, “Request Entity body conversion”</a> for a discussion of when serialization
occurs in constructing a request.</p>

<p><a id="err.inline.C0040"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0040"><code class="errqname">err:XC0040</code></a>)
if the document element of the document that arrives on the
<code class="port">source</code> port is not <a href="#cv.request"><code class="tag-element">c:request</code></a>.</p>

<div id="ednote-json" class="note admonition"><h3>Editorial Note</h3><div class="admonition-body">

<p>Can the input document be JSON?</p>
</div></div>

<section id="cv.request" class="section"><div class="section-titlepage"><h5>1.1.11.1 Specifying a request</h5></div>


<p>An HTTP request is represented by a <code class="tag-element">c:request</code> element.</p>

<p id="d722e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:request<br />  <strong>method</strong> = <var>NCName</var><br />  href? = <var>anyURI</var><br />  detailed? = <var>boolean</var><br />  status-only? = <var>boolean</var><br />  username? = <var>string</var><br />  password? = <var>string</var><br />  auth-method? = <var>string</var><br />  send-authorization? = <var>boolean</var><br />  override-content-type? = <var>ContentType</var>&gt;<br />    (<a href="#cv.header">c:header</a>*,<br />     (<a href="#cv.multipart">c:multipart</a> | <br />      <a href="#cv.body">c:body</a>)?)<br />&lt;/c:request&gt;</code></p>

<p><a id="err.inline.C0006"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0006"><code class="errqname">err:XC0006</code></a>) if the
<code class="tag-attribute">method</code> is not specified on a <code class="tag-element">c:request</code>.

<a id="err.inline.C0005"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0005"><code class="errqname">err:XC0005</code></a>) if the
request contains a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> but the
<code class="tag-attribute">method</code> does not allow for an entity body being sent with the request.</p>

<p><a id="err.inline.C0004"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0004"><code class="errqname">err:XC0004</code></a>) if the
<code class="code">status-only</code> attribute has the value <code class="literal">true</code> and
the <code class="code">detailed</code> attribute does not have the value <code class="literal">true</code>.</p>

<p>The <code class="code">method</code> attribute specifies the method to be
used against the IRI specified by the <code class="code">href</code> attribute,
e.g. <code class="code">GET</code> or <code class="code">POST</code> (the value is not case-sensitive).
If the <code class="code">href</code>
attribute is not absolute, it will be resolved against the base URI of
the element on which it is occurs.</p>

<div id="note-http-get" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>In the case of simple “GET” requests, implementors are encouraged
to support as many protocols as practical. In particular, pipeline authors may
attempt to use <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> to load documents with computed
URIs using the <code class="literal">file:</code> scheme.</p></div></div>

<p>If the <code class="code">username</code> attribute is specified, the
<code class="code">username</code>, <code class="code">password</code>,
<code class="code">auth-method</code>, and <code class="code">send-authorization</code>
attributes are used to handle authentication according to the selected
authentication method.</p>

<p>For the purposes of avoiding an authentication challenge, if the
<code class="code">send-authorization</code> attribute has the value
<code class="literal">true</code> and the authentication method specified by the
<code class="code">auth-method</code> supports generation of an
<code class="code">Authorization</code> header without a challenge, then an
<code class="code">Authorization</code> header is generated and sent on the first
request. If the <code class="code">send-authorization</code> attribute is absent or
has the value
<code class="literal">false</code>, then the first request is sent without an
<code class="code">Authorization</code> header.</p>

<p>If the initial response to the request is an
authentication challenge, the <code class="code">auth-method</code>,
<code class="code">username</code>, <code class="code">password</code> and any relevant data from
the challenge are used to generate an
<code class="code">Authorization</code> header and the request is sent again. If
that authorization fails, the request is not retried.</p>

<p>Appropriate values for the <code class="code">auth-method</code> attribute
are “Basic” or “Digest” but other values are allowed.
If the authentication method is “Basic” or “Digest”, authentication
is handled as per [<a href="#rfc2617"><span class="abbrev">RFC 2617</span></a>].
<span id="impl-7">The
interpretation of <code class="code">auth-method</code> values on
<code class="tag-element">c:request</code> other than “Basic” or “Digest” is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p><a id="err.inline.C0003"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0003"><code class="errqname">err:XC0003</code></a>) if a <code class="option">username</code>
or <code class="option">password</code> is specified without specifying an
<code class="option">auth-method</code>, if
the requested
<code class="option">auth-method</code> isn't supported, or the authentication
challenge contains an authentication method that isn't
supported. All implementations are required to support "Basic"
and "Digest" authentication per [<a href="#rfc2617"><span class="abbrev">RFC 2617</span></a>].</p>

  <p>The <code class="code">c:header</code> element specifies a
header name and value, either for inclusion in a request, or as received in a response.</p>

<p id="cv.header" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:header<br />  <strong>name</strong> = <var>string</var><br />  <strong>value</strong> = <var>string</var> /&gt;</code></p>

<p>The request is formulated from the attribute values on the
<code class="tag-element">c:request</code> element and its
<a href="#cv.header"><code class="tag-element">c:header</code></a> and <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> or <a href="#cv.body"><code class="tag-element">c:body</code></a> children,
if present, and transmitted to the host (and port, if present) specified by the
<code class="code">href</code> attribute.  The details of how the request entity body, if any, is
constructed are given in <a href="#c.response_body" title="Converting Response Entity Bodies">Section 1.1.11.5, “Converting Response Entity Bodies”</a>.</p>

<p>When the request is formulated, the step and/or protocol
implementation may add headers as necessary to either complete the
request or as appropriate for the content specified (e.g. transfer
encodings). A user of this step is guaranteed that their requested
headers and content will be sent with the exception of any conflicts
with protocol-related headers.</p>

<p>The <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step allows users to specify
independently values that are not always independent. For example,
some combinations of <a href="#cv.header"><code class="tag-element">c:header</code></a> values
(e.g., <code class="literal">Content-Type</code>)
may be inconsistent
with values that the step and/or protocol implementation must set. In
a few cases, the step provides more than one mechanism to specify what
is actually a single value (e.g., the boundary string in multipart
messages).
<a id="err.inline.C0020"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0020"><code class="errqname">err:XC0020</code></a>) if the the user specifies a value
or values that are inconsistent with each other or with the requirements
of the step or protocol.
</p>
</section>

<section id="file-globbing" class="section"><div class="section-titlepage"><h5>1.1.11.2 Filename globbing</h5></div>


<p>Implementations that support <code class="literal">file:</code> URIs,
<span class="rfc2119" id="file-globbing.2.2">should</span> support “globbing”. For example, the
URI <code class="uri">file:///path/to/dir/*.xml</code> should return all of the
XML documents in the directory
<code class="filename">/path/to/dir</code>.</p>

<div id="ednote-globbing" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>Must define the globbing rules!</p>
</div></div>
</section>

<section id="c.request_body" class="section"><div class="section-titlepage"><h5>1.1.11.3 Request Entity body conversion</h5></div>


<p>The <code class="code">c:multipart</code> element specifies a multi-part
body, per [<a href="#rfc1521"><span class="abbrev">RFC 1521</span></a>], either for inclusion in a
request or as received in a response.</p>

<p id="cv.multipart" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:multipart<br />  <strong>content-type</strong> = <var>ContentType</var><br />  <strong>boundary</strong> = <var>string</var>&gt;<br />    <a href="#cv.body">c:body</a>+<br />&lt;/c:multipart&gt;</code></p>

<p>In the context of a request, the media type of the
<a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> <span class="rfc2119" id="c.request_body.4.2">must</span> be a multipart media
type (i.e. have a main type of 'multipart'). If the
<code class="code">content-type</code> attribute is not specified, a value of
“<code class="literal">multipart/mixed</code>” will be assumed. (<span id="impl-8">Whether
or not, and to what extent, “<code class="literal">multipart/byte-ranges</code>”
responses are supported is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.)</span>
</p>

<p>The <code class="code">boundary</code> attribute is required and is used to
provide a multipart boundary marker. The implementation must use this
boundary marker and must prefix the value with the string
“<code class="literal">--</code>” when formulating the multipart message. <a id="err.inline.C0002"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0002"><code class="errqname">err:XC0002</code></a>) if the value
starts with the string “<code class="literal">--</code>”.</p>

<p>If the boundary is also specified as a parameter in the
<code class="option">content-type</code> option, then the parameter value specified
and the <code class="option">boundary</code> value specified <span class="rfc2119" id="c.request_body.6.3">must</span>
be the same. If the boundary is specified in both the <code class="option">boundary</code>
option and the <code class="option">content-type</code> option then the two values
<span class="rfc2119" id="c.request_body.6.6">must</span> be the same.</p>

<p>The <a href="#cv.body"><code class="tag-element">c:body</code></a> element holds the body or body part of the message.  Each of the attributes holds controls some aspect of the encoding the request body or decoding the body element's content when the request is formulated.  These are specified as follows:</p>

<p id="cv.body" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:body<br />  <strong>content-type</strong> = <var>ContentType</var><br />  encoding? = <var>string</var><br />  id? = <var>string</var><br />  description? = <var>string</var><br />  disposition? = <var>string</var>&gt;<br />    <var>anyElement</var>*<br />&lt;/c:body&gt;</code></p>

<p>The <code class="code">content-type</code> attribute specifies the media type
of the body or body part, that is, the value of its
<code class="code">Content-Type</code> header. If the media type is not an XML type
or text, the content must already be base64-encoded.</p>

<p>The <code class="code">encoding</code> attribute controls the decoding of the
element content for formulating the body. A value of
<code class="literal">base64</code> indicates the element's content is a base64
encoded string whose byte stream should be sent as the message body.
<span id="impl-9">An implementation may support encodings other than
<code class="literal">base64</code> but these encodings and their names are
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
<a id="err.inline.C0052"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0052"><code class="errqname">err:XC0052</code></a>) if the encoding specified is not supported by the
implementation.</p>

<div id="note-single-set-ser" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>The <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step provides only a single set of
serialization options for XML media types. There's no direct support
for sending a multipart message with two XML parts encoded
differently.</p>
</div></div>

<p>For each body or body part, the <code class="code">id</code> attribute
specifies the value of the <code class="code">Content-ID</code> header;
the <code class="code">description</code> attribute specifies the
value of the <code class="code">Content-Description</code> header;
and the <code class="code">disposition</code> attribute specifies the value
of the <code class="code">Content-Disposition</code> header.
</p>

<p>If an entity body is to be sent as part of a request (e.g. a
<code class="code">POST</code>), either a <a href="#cv.body"><code class="tag-element">c:body</code></a> element, specifying the
request entity body, or a <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element, specifying
multiple entity body parts, may be used. When <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a>
is used it may contain multiple <a href="#cv.body"><code class="tag-element">c:body</code></a> children. A
<a href="#cv.body"><code class="tag-element">c:body</code></a> specifies the construction of a body or body part as
follows:</p>

<p>If the <code class="code">content-type</code> attribute does not specify an
XML media type, or the <code class="code">encoding</code> attribute is
“<code class="literal">base64</code>”, then <a id="err.inline.C0028"></a>it is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0028"><code class="errqname">err:XC0028</code></a>) if the content of the
<a href="#cv.body"><code class="tag-element">c:body</code></a> element does not consist entirely of
characters, and the entity body or body part will consist of
exactly those characters.</p>

<p>Otherwise (the <code class="code">content-type</code> attribute
<em>does</em> specify an XML media type and the
<code class="code">encoding</code> attribute is <em>not</em> 'base64'),
<a id="err.inline.C0022"></a>it is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0022"><code class="errqname">err:XC0022</code></a>) if
the content of the <a href="#cv.body"><code class="tag-element">c:body</code></a> element does not consist of
exactly one element, optionally preceded and/or followed by any number
of processing instructions, comments or whitespace characters,
and the entity body or body part will consist of the serialization of
a document node containing that content. The serialization of that
document is controlled by the serialization options on the
<code class="code">p:http-request</code> step itself.</p>

<p>For example, the following input to a
<code class="code">p:http-request</code> step will POST a small XML
document:</p>

<pre class="programlisting language-markup line-numbers"><code>&lt;c:request method="POST" href="http://example.com/someservice"&gt;
&lt;c:body xmlns:c="http://www.w3.org/ns/xproc-step" content-type="application/xml"&gt;
&lt;doc&gt;
&lt;title&gt;My document&lt;/title&gt;
&lt;/doc&gt;
&lt;/c:body&gt;
&lt;/c:request&gt;
</code></pre>
  <p>The corresponding request should look something like this:</p>

  <pre class="programlisting language-markup line-numbers"><code>POST http://example.com/someservice HTTP/1.1
Host: example.com
Content-Type: application/xml; charset="utf-8"

&lt;?xml version='1.0'?&gt;
&lt;doc&gt;
&lt;title&gt;My document&lt;/title&gt;
&lt;/doc&gt;
</code></pre>
</section>

<section id="c.request_response" class="section"><div class="section-titlepage"><h5>1.1.11.4 Managing the response</h5></div>


<div id="ednote-content-types" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>Where do we say that ffor URI schemes (such as
<code class="code">file:</code> and <code class="code">ftp:</code>) where a content type is not
provided by the underlying request, the content type is
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>?</p>
</div></div>

<p>The handling of the response to the request and the generation
of the step's result document is controlled by the
<code class="code">status-only</code>, <code class="code">override-content-type</code> and
<code class="code">detailed</code> attributes on the <a href="#cv.request"><code class="tag-element">c:request</code></a>
input.</p>

<p>The <code class="code">override-content-type</code> attribute controls
interpretation of the response's <code class="code">Content-Type</code> header. If
this attribute is present, the response will be treated as if it
returned the <code class="code">Content-Type</code> given by its value. This
original <code class="code">Content-Type</code> header will however be reflected
unchanged as a <a href="#cv.header"><code class="tag-element">c:header</code></a> in the result document. <a id="err.inline.C0030"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0030"><code class="errqname">err:XC0030</code></a>) if the
<code class="code">override-content-type</code> value cannot be used (e.g.
<code class="code">text/plain</code> to override
<code class="code">image/png</code>).</p>

<p>If the <code class="code">override-content-type</code> includes an encoding
parameter, then that encoding <span class="rfc2119" id="c.request_response.5.2">must</span> be used to
read the document.</p>

<p>If the <code class="code">status-only</code> attribute has the value
<code class="literal">true</code>, the result document will contain only header
information. The entity of the response will not be processed to
produce a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element.</p>

<p>The <a href="#c.response"><code class="tag-element">c:response</code></a> element represents an HTTP response.
The response's status code is encoded in the <code class="code">status</code>
attribute and the headers and entity body are processing into
<a href="#cv.header"><code class="tag-element">c:header</code></a> and <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> or <a href="#cv.body"><code class="tag-element">c:body</code></a>
content.</p>

<p id="c.response" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:response<br />  status? = <var>integer</var>&gt;<br />    (<a href="#cv.header">c:header</a>*,<br />     (<a href="#cv.multipart">c:multipart</a> | <br />      <a href="#cv.body">c:body</a>)?)<br />&lt;/c:response&gt;</code></p>

<p>The value of the <code class="code">detailed</code> attribute determines the
content of the result document. If it is <code class="literal">true</code>, the
response to the request is handled as follows:</p>

<div class="orderedlist">



<ol style="list-style: decimal;"><li><p>A single <a href="#c.response"><code class="tag-element">c:response</code></a> element is produced with the <code class="code">status</code> attribute containing the status of the response received.</p></li><li><p>Each response header is translated into a <a href="#cv.header"><code class="tag-element">c:header</code></a> element.</p></li><li><p>Unless the <code class="code">status-only</code> attribute has a value
<code class="literal">true</code>, the entity body of the response is converted into
a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element via the rules given in
 <a href="#c.response_body" title="Converting Response Entity Bodies">Section 1.1.11.5, “Converting Response Entity Bodies”</a>.</p></li></ol></div>

<p>Otherwise (the <code class="code">detailed</code> attribute is not specified
or its value is <code class="literal">false</code>), the response to the request
is handled as follows:</p>

<div class="orderedlist">


<ol style="list-style: decimal;"><li><p>If the media type (as determined by the
<code class="code">override-content-type</code> attribute or the
<code class="code">Content-Type</code> response header) is an XML media type, the
entity is decoded if necessary, then parsed as an XML document:</p>

<div class="itemizedlist">




<ul><li>
<p>The parser which <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> employs
<span class="rfc2119" id="c.request_response.12.1.2.1.1.2">must</span> process the external subset; all general and
external parsed entities <span class="rfc2119" id="c.request_response.12.1.2.1.1.3">must</span> be fully expanded.</p>

<div id="ednote-parser" class="note admonition"><h3>Editorial Note</h3><div class="admonition-body">

<p>The requirement to process the external subset comes from p:load,
we probably don't want to impose that on all p:http-request calls.
Need a way to control it?</p>
</div></div>

</li><li>
<p>It
<span class="rfc2119" id="c.request_response.12.1.2.2.1.1">may</span> perform <code class="tag-attribute">xml:id</code>
processing, but it <span class="rfc2119" id="c.request_response.12.1.2.2.1.3">must not</span> perform any other
processing, such as expanding XIncludes.</p>
</li><li>
<p>The parser
<span class="rfc2119" id="c.request_response.12.1.2.3.1.1">must</span> be conformant to <em class="citetitle">Namespaces in
XML</em>.</p>
</li><li>
<p>Parsing the document
<span class="rfc2119" id="c.request_response.12.1.2.4.1.1">must not</span> fail due to validation errors.
</p>
</li></ul></div>

<p>The resulting XML document is
produced on the <code class="code">result</code> output port as the entire output
of the step.</p>

</li><li><p>Otherwise, the entity body of the response is converted into
a <a href="#cv.body"><code class="tag-element">c:body</code></a> or <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element via the rules given in
<a href="#c.response_body" title="Converting Response Entity Bodies">Section 1.1.11.5, “Converting Response Entity Bodies”</a>.</p></li></ol></div>

<p>In either case the base URI of the output document is the resolved value
of the <code class="code">href</code> attribute from the input <a href="#cv.request"><code class="tag-element">c:request</code></a>.</p>

<section id="redirects" class="section"><div class="section-titlepage"><h6>1.1.11.4.1 Redirects</h6></div>


<p>One possible response from an HTTP request is a redirect,
indicated by a status code in the three-hundred range. The precise
semantics of the 3xx return codes are laid out by section
<em class="citetitle">10.3 Redirection 3xx</em> in [<a href="#rfc2616"><span class="abbrev">RFC 2616</span></a>].
</p>

<p>The <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step <span class="rfc2119" id="redirects.3.2">should</span> follow
redirect requests (in a manner consistent with [<a href="#rfc2616"><span class="abbrev">RFC 2616</span></a>])
if they are returned by the server.
</p>
</section>

<section id="cookies" class="section"><div class="section-titlepage"><h6>1.1.11.4.2 Cookies</h6></div>


<p>With one exception, in version 1.0 of XProc, the
<a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step does not provide any standard
mechanisms for managing cookies. <span id="impl-10">Pipeline authors that need to
preserve cookies across several <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> calls in the
same pipeline or across multiple invocations of the same or different
pipelines will have to rely on
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> mechanisms.</span>
</p>

<p>The exception arises in the case of redirection. If a redirect
response includes cookies, those cookies <span class="rfc2119" id="cookies.3.1">should</span> be
forwarded as appropriate to the redirected location when the
redirection is followed.</p>

<p>This behavior will allow the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step to
interoperate with web services that use cookies as part of an
authentication protocol.</p>

</section>
 </section>

<section id="c.response_body" class="section"><div class="section-titlepage"><h5>1.1.11.5 Converting Response Entity Bodies</h5></div>


<p>The entity of a response may be multipart per [<a href="#rfc1521"><span class="abbrev">RFC 1521</span></a>]. In those situations, the result document will be
a <a href="#cv.multipart"><code class="tag-element">c:multipart</code></a> element that contains multiple
<a href="#cv.body"><code class="tag-element">c:body</code></a> elements inside.</p>

<div id="note-multipart-multipart" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>Although it is technically possible for any of the individual
parts of a multipart message to <em>also</em> be
multipart, XProc does not provide a standard representation for such
messages. <span id="impl-11">The interpretation of a multipart message inside
another multipart message is
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>
</div></div>

<p>The result of the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step is an XML
document. For media types (images, binaries, etc.) that can't be
represented as a sequence of Unicode characters, the response is
encoded as <code class="literal">base64</code>
and then returned as text children of the <a href="#cv.body"><code class="tag-element">c:body</code></a> element.
If the content is base64-encoded, the <code class="tag-attribute">encoding</code> attribute on <a href="#cv.body"><code class="tag-element">c:body</code></a> must
be set to “<code class="literal">base64</code>”.</p>

<div id="ednote-non-xml" class="note admonition"><h3>Editorial Note</h3><div class="admonition-body">

<p>This section hasn't been updated to reflect the fact that
non-XML documents are now possible. It should probably say
something like:</p>
<p>If the document identified has a non-XML content type, no extra
processing is mandated. The number and variety of media types
that an implementation can load is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</p>
</div></div>

<p>If the media type of the response
is a text type with a
<code class="code">charset</code> parameter that is a Unicode character encoding
(per [<a href="#unicodetr17"><span class="abbrev">Unicode TR#17</span></a>]) or
is recognized as a non-XML media type whose contents are encoded as a
sequence of Unicode characters (e.g. it has a character parameter or
the definition of the media type is such that it requires Unicode),
the content of the constructed <a href="#cv.body"><code class="tag-element">c:body</code></a> element is the translation
of the text into a sequence of Unicode characters.</p>

<p>If the response is an XML media type, the content of the
constructed <a href="#cv.body"><code class="tag-element">c:body</code></a> element is the result of decoding the
body as necessary, then parsing it with an XML parser.</p>

<div class="itemizedlist">




<ul><li>
<p>The parser which <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> employs
<span class="rfc2119" id="c.response_body.8.1.1.2">must</span> process the external subset; all general and
external parsed entities <span class="rfc2119" id="c.response_body.8.1.1.3">must</span> be fully expanded.</p>

<div id="ednote-parser" class="note admonition"><h3>Editorial Note</h3><div class="admonition-body">

<p>The requirement to process the external subset comes from p:load,
we probably don't want to impose that on all p:http-request calls.
Need a way to control it?</p>
</div></div>

</li><li>
<p>It
<span class="rfc2119" id="c.response_body.8.2.1.1">may</span> perform <code class="tag-attribute">xml:id</code>
processing, but it <span class="rfc2119" id="c.response_body.8.2.1.3">must not</span> perform any other
processing, such as expanding XIncludes.</p>
</li><li>
<p>The parser
<span class="rfc2119" id="c.response_body.8.3.1.1">must</span> be conformant to <em class="citetitle">Namespaces in
XML</em>.</p>
</li><li>
<p>Parsing the document
<span class="rfc2119" id="c.response_body.8.4.1.1">must not</span> fail due to validation errors.
</p>
</li></ul></div>

<p>If the content
is not well-formed, the step fails.</p>

<div id="ednote-combine-parsing" class="note admonition"><h3>Editorial Note</h3><div class="admonition-body">

<p>This prose should be consolidated into a single place.</p>
</div></div>

<p>In a <a href="#cv.body"><code class="tag-element">c:body</code></a> in a response, the
<code class="tag-attribute">content-type</code> attribute <span class="rfc2119" id="c.response_body.11.3">must</span>
be an exact copy of the value returned in the
<code class="literal">Content-Type</code> header. That is, it must reflect the
content type actually returned, not any override value that may have been
specified, and it must include any parameters returned by the server.</p>

<p>In the case of a multipart response, the same rules apply when
constructing a <a href="#cv.body"><code class="tag-element">c:body</code></a> element for each body part
encountered.</p>

<div id="note-text-html" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>Given the above description, any content identified as
<code class="code">text/html</code> will be encoded as (escaped) text or
base64-encoded in the <a href="#cv.body"><code class="tag-element">c:body</code></a> element, as HTML isn't always
well-formed XML. A user can attempt to convert such content into XML
using the <a href="#c.unescape-markup"><code class="tag-element">p:unescape-markup</code></a> step.</p>
</div></div>
</section>

<section id="example-http-request" class="section"><div class="section-titlepage"><h5>1.1.11.6 HTTP Request Example</h5></div>


<p>A simple form might be posted as follows:</p>
<pre class="programlisting language-markup line-numbers"><code>&lt;c:request method="POST" href="http://www.example.com/form-action" xmlns:c="http://www.w3.org/ns/xproc-step"&gt;
&lt;c:body content-type="application/x-www-form-urlencoded"&gt;
name=W3C&amp;amp;spec=XProc
&lt;/c:body&gt;
&lt;/c:request&gt;</code></pre>
<p>and if the response was an XHTML document, the result document would be:</p>
<pre class="programlisting language-markup line-numbers"><code>&lt;c:response status="200" xmlns:c="http://www.w3.org/ns/xproc-step"&gt;
&lt;c:header name="Date" value=" Wed, 09 May 2007 23:12:24 GMT"/&gt;
&lt;c:header name="Server" value="Apache/1.3.37 (Unix) PHP/4.4.5"/&gt;
&lt;c:header name="Vary" value="negotiate,accept"/&gt;
&lt;c:header name="TCN" value="choice"/&gt;
&lt;c:header name="P3P" value="policyref='http://www.w3.org/2001/05/P3P/p3p.xml'"/&gt;
&lt;c:header name="Cache-Control" value="max-age=600"/&gt;
&lt;c:header name="Expires" value="Wed, 09 May 2007 23:22:24 GMT"/&gt;
&lt;c:header name="Last-Modified" value="Tue, 08 May 2007 16:10:49 GMT"/&gt;
&lt;c:header name="ETag" value="'4640a109;42380ddc'"/&gt;
&lt;c:header name="Accept-Ranges" value="bytes"/&gt;
&lt;c:header name="Keep-Alive" value="timeout=2, max=100"/&gt;
&lt;c:header name="Connection" value="Keep-Alive"/&gt;
&lt;c:body content-type="application/xhtml+xml"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;&lt;title&gt;OK&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;p&gt;OK!&lt;/p&gt;&lt;/body&gt;
&lt;/html&gt;
&lt;/c:body&gt;
&lt;/c:response&gt;</code></pre>
</section>

</section>
<section id="c.identity" class="section"><div class="section-titlepage"><h4>1.1.12 p:identity</h4></div>


<p>The <code class="code">p:identity</code> step makes a verbatim copy of its input
available on its output.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:identity</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>If the implementation supports passing PSVI annotations between
steps, the <code class="tag-element">p:identity</code> step <span class="rfc2119" id="c.identity.4.2">must</span> preserve
any annotations that appear in the input.</p>

</section>
<section id="c.insert" class="section"><div class="section-titlepage"><h4>1.1.13 p:insert</h4></div>


<p>The <code class="code">p:insert</code> step inserts the
<code class="code">insertion</code> port's document into the <code class="port">source</code>
port's document relative to the matching elements in the
<code class="code">source</code> port's document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:insert</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">insertion</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'/*'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>         </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">position</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>     </code><code class="comment">&lt;!-- </code><span class="opt-type">"first-child" | "last-child" | "before" | "after"</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option
<span class="rfc2119" id="c.insert.4.2">must</span> be an XSLTMatchPattern. <a id="err.inline.C0023.1"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches
anything other than element, text, processing-instruction, or comment nodes.
Multiple matches are
allowed, in which case multiple copies of the <code class="port">insertion</code>
documents will occur. If no elements match, then the document is
unchanged.</p>

<p>The value of the <code class="option">position</code> option <span class="rfc2119" id="c.insert.5.2">must</span> be an NMTOKEN in
the following list:
</p>

<div class="itemizedlist">




<ul><li>
<p>“<code class="literal">first-child</code>” - the insertion is made as the first child of the match;</p>
</li><li>
<p>“<code class="literal">last-child</code>” - the insertion is made as the last child of the match;</p>
</li><li>
<p>“<code class="literal">before</code>” - the insertion is made as the immediate preceding sibling of the match;</p>
</li><li>
<p>“<code class="literal">after</code>” - the insertion is made as the immediate following sibling of the match.</p>
</li></ul></div>

<p><a id="err.inline.C0025"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0025"><code class="errqname">err:XC0025</code></a>)
if the match pattern matches anything other than an element node and
the value of the <code class="option">position</code> option is
“<code class="literal">first-child</code>” or
“<code class="literal">last-child</code>”.</p>

<p>As the inserted elements are part of the output of the step they
are not considered in determining matching elements. If an empty sequence
appears on the <code class="port">insertion</code> port, the result will be the same
as the source.</p>

</section>
<section id="c.label-elements" class="section"><div class="section-titlepage"><h4>1.1.14 p:label-elements</h4></div>


<p>The <code class="code">p:label-elements</code> step generates a label for each matched
element and stores that label in the specified attribute.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:label-elements</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'xml:id'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">attribute-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">label</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'concat("_",$p:index)'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'*'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>          </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">replace</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'true'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">attribute</code> option
<span class="rfc2119" id="c.label-elements.4.2">must</span> be a <code class="type">QName</code>.
If the lexical value does not contain a colon, then the <code class="tag-attribute">attribute-namespace</code> may be used to specify the
namespace of the attribute name. In that case, the <code class="tag-attribute">attribute-prefix</code> may be specified to suggest a
prefix for the attribute name. <a id="err.inline.D0034.2"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) to specify a new namespace or
prefix if the lexical value of the specified name contains a
colon.
</p>

<p>The value of the <code class="option">label</code> option is an XPath
expression used to generate the value of the attribute label.</p>

<p>The value of the <code class="option">match</code> option
<span class="rfc2119" id="c.label-elements.6.2">must</span> be an XSLTMatchPattern. <a id="err.inline.C0023.2"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that expression matches
anything other than element nodes.</p>

<p>The value of the <code class="option">replace</code>
<span class="rfc2119" id="c.label-elements.7.2">must</span> be a boolean value and is used to indicate
whether existing attribute values are replaced.</p>

<p>This step operates by generating attribute labels for each
element matched. For every matched element, the expression is
evaluated with the context node set to the matched element. An
attribute is added to the matched element using the attribute name is
specified the <code class="option">attribute</code> option and the string value
of result of evaluating the expression. If the attribute already
exists on the matched element, the value is replaced with the string
value only if the <code class="option">replace</code> option has the value of
<code class="literal">true</code>.</p>

<p>If this step is used to add or change the value
of an attribute named “<code class="literal">xml:base</code>”, the base URI
of the element <span class="rfc2119" id="c.label-elements.9.2">must</span> also be amended accordingly.</p>

<p>An implementation must bind the variable
“<code class="literal">p:index</code>” in the static context of each evaluation
of the XPath expression to the position of the element in the sequence
of matched elements. In other words, the first element (in document
order) matched gets the value “<code class="literal">1</code>”, the second gets
the value “<code class="literal">2</code>”, the third, “<code class="literal">3</code>”,
etc.</p>

<p>The result of the p:label-elements step is the input document with the
attribute labels associated with matched elements.  All other non-matching content
remains the same.</p>

</section>
<section id="c.load" class="section"><div class="section-titlepage"><h4>1.1.15 p:load</h4></div>


<p>The <code class="code">p:load</code> step has no inputs but produces as its
result a document (or documents) specified by an IRI.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:load</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">href</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">dtd-validate</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">document-properties</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName, item())</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">href</code> option
<span class="rfc2119" id="c.load.4.2">must</span> be an <code class="type">anyURI</code>. It is interpreted
as an IRI reference. If it is relative, it is made absolute against
the base URI of the element on which it is specified
(<a href="../xproc30/#p.with-option">p:with-option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> or <code class="tag-element">p:load</code> in the case of a
<span class="xspecref"><a href="../xproc30/#option-shortcut">syntactic shortcut</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span> value).</p>

<p>The document or documents identified by the URI is loaded and returned. If the
URI protocol supports redirection, then redirects
<span class="rfc2119" id="c.load.5.1">must</span> be followed.</p>

<p>If <code class="option">dtd-validate</code> is <code class="literal">false</code>,
the <code class="tag-element">p:load</code> step is equivalent to performing the following
<a href="#c.http-request"><code class="tag-element">p:http-request</code></a>:</p>

<pre class="programlisting language-markup line-numbers"><code>&lt;p:http-request&gt;
  &lt;p:input port="source"&gt;
    &lt;p:inline&gt;
      &lt;c:request method="GET"
                 href="{HREF}"
                 detailed="false"
                 status-only="false"
                 override-content-type="{OVERRIDE}"/&gt;
    &lt;/p:inline&gt;
  &lt;/p:input&gt;
&lt;/p:http-request&gt;</code></pre>

<p>Where the “<code class="literal">{HREF}</code>” value is the value of
the <code class="option">href</code> option made absolute and the
“<code class="literal">{OVERRIDE}</code>” value is the value returned by 
<code class="literal">map:get($document-properties,'content-type')</code>. If no value is provided
for the <code class="option">document-properties</code> option or the provided map does not contain 
a key 'content-type', then the
<code class="tag-attribute">override-content-type</code> attribute is not
present on the <a href="#cv.request"><code class="tag-element">c:request</code></a>.</p>

<p>If <code class="option">dtd-validate</code> is <code class="literal">true</code>,
the <code class="tag-element">p:load</code> step is equivalent to performing the following
pipeline:</p>

<pre class="programlisting language-markup line-numbers"><code>&lt;p:declare-step&gt;
  &lt;p:output port="result" sequence="false"/&gt;
  &lt;p:option name="href" required="true"/&gt;
  &lt;p:option name="document-properties"/&gt;

  &lt;p:http-request&gt;
    &lt;p:input port="source"&gt;
      &lt;p:inline expand-text="true"&gt;
        &lt;c:request method="GET"
                   href="{$href}"
                   detailed="false"
                   status-only="false"
                   override-content-type="text/plain"/&gt;
      &lt;/p:inline&gt;
    &lt;/p:input&gt;
  &lt;/p:http-request&gt;

  &lt;p:xml-parse dtd-validate="true"/&gt;

  &lt;p:choose&gt;
    &lt;p:when test="p:value-available('document-properties') and map:contains($document-properties,'content-type')"&gt;
      &lt;p:cast-content-type content-type="{map:get($document-properties,'content-type')}"/&gt;
    &lt;/p:when&gt;
    &lt;p:otherwise&gt;
      &lt;p:identity/&gt;
    &lt;/p:otherwise&gt;
  &lt;/p:choose&gt;
&lt;/p:declare-step&gt;</code></pre>

<p>The retrieved document or documents are produced on the
<code class="port">result</code> port. For single part responses, the base URI of
the result is the (absolute) IRI used to retrieve it. For multipart
responses, the base URI of each part is the (absolute) IRI used to
retrieve it unless the <code class="code">content-disposition</code> header indicates
a URI. If the <code class="code">content-disposition</code> header indicates a relative
URI, it is made absolute agains the (absolute) IRI used to retreive it.</p>

<div id="ednote-load" class="note admonition"><h3>Editorial Note</h3><div class="admonition-body">

<p>How does the preceding paragraph jibe with what
<a href="#c.http-request"><code class="tag-element">p:http-request</code></a> says about multipart responses?</p>
</div></div>
</section>
<section id="c.make-absolute-uris" class="section"><div class="section-titlepage"><h4>1.1.16 p:make-absolute-uris</h4></div>


<p>The <code class="code">p:make-absolute-uris</code> step makes an element or
attribute's value in the source document an absolute IRI value in the
result document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:make-absolute-uris</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">base-uri</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>                    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.make-absolute-uris.4.2">must</span> be an
XSLTMatchPattern.
<a id="err.inline.C0023.3"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if
the pattern matches anything other than element or attribute
nodes.</p>

<p>The value of the <code class="option">base-uri</code> option
<span class="rfc2119" id="c.make-absolute-uris.5.2">must</span> be an <code class="type">anyURI</code>. It is interpreted
as an IRI reference. If it is relative, it is made absolute against
the base URI of the element on which it is specified
(<a href="../xproc30/#p.with-option">p:with-option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> or <code class="tag-element">p:make-absolute-uris</code> in the case of
a <span class="xspecref"><a href="../xproc30/#option-shortcut">syntactic shortcut</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>
value).</p>

<p>For every element or attribute in the input document which
matches the specified pattern, its XPath string-value is resolved
against the specified base URI and the resulting absolute IRI is used
as the matched node's entire contents in the output.</p>

<p>The base URI used for resolution defaults to the matched
attribute's element or the matched element's base URI unless the
<code class="option">base-uri</code> option is specified. When the
<code class="option">base-uri</code> option is specified, the option value is
used as the base URI regardless of any contextual base URI value in
the document. This option value is resolved against the base URI of
the <a href="../xproc30/#p.option">p:option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> element used to set the option.</p>

<p><span id="impl-12">If the IRI reference specified by the <code class="option">base-uri</code> option
on <code class="tag-element">p:make-absolute-uris</code> is
not valid, or if it is absent and the input document has no base URI,
the results are <em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>

</section>
<section id="c.namespace-rename" class="section"><div class="section-titlepage"><h4>1.1.17 p:namespace-rename</h4></div>


<p>The <code class="code">p:namespace-rename</code> step renames any namespace declaration or
use of a namespace in a document to a new IRI value.</p>

 <p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:namespace-rename</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">from</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>                        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">to</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>                          </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">apply-to</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'all'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>      </code><code class="comment">&lt;!-- </code><span class="opt-type">"all" | "elements" | "attributes"</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">from</code> option
<span class="rfc2119" id="c.namespace-rename.4.2">must</span> be an <code class="type">anyURI</code>. It
<span class="rfc2119" id="c.namespace-rename.4.4">should</span> be either empty or absolute, but will not be
resolved in any case.</p>

<p>The value of the <code class="option">to</code> option
<span class="rfc2119" id="c.namespace-rename.5.2">must</span> be an <code class="type">anyURI</code>. It
<span class="rfc2119" id="c.namespace-rename.5.4">should</span> be empty or absolute, but will not be
resolved in any case.</p>

<p>The value of the <code class="option">apply-to</code> option
<span class="rfc2119" id="c.namespace-rename.6.2">must</span> be one of “<code class="literal">all</code>”,
“<code class="literal">elements</code>”, or “<code class="literal">attributes</code>”.
If the value is “<code class="literal">elements</code>”, only elements will be
renamed, if the value is “<code class="literal">attributes</code>”, only attributes
will be renamed, if the value is “<code class="literal">all</code>”, both elements
and attributes will be renamed.</p>

<p><a id="err.inline.C0014"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0014"><code class="errqname">err:XC0014</code></a>)
if the XML namespace (<code class="uri">http://www.w3.org/XML/1998/namespace</code>)
or the XMLNS namespace (<code class="uri">http://www.w3.org/2000/xmlns/</code>) is
the value of either the <code class="option">from</code> option or the
<code class="option">to</code> option.</p>

<p>If the value of the <code class="option">from</code> option is the same as
the value of the <code class="option">to</code> option, the input is reproduced
unchanged on the output. Otherwise, namespace bindings, namespace
attributes and element and attribute names are changed as
follows:</p>

<div class="itemizedlist">
  
  
  
 <ul><li>
   <p>Namespace bindings:  If the <code class="option">from</code> option is present
and its value is not the empty string,
then every binding of a prefix (or the default namespace) in the input
document whose value is the same as the value of the <code class="option">from</code>
option is</p>
   <div class="itemizedlist">
    
    
   <ul><li>
     <p>replaced in the output with a binding to the value of the <code class="option">to</code>
option, provided it is present and not the empty string;</p>
    </li><li>
     <p>otherwise (the <code class="option">to</code> option is
not specified or has an empty string as its value) absent from the output.</p>
    </li></ul></div>
   <p>If the <code class="option">from</code> option is absent, or its value is the empty string,
then no bindings are changed or removed.</p>
  </li><li>
   <p>Elements and attributes: If the <code class="option">from</code> option is present
and its value is not the empty string, for every element and attribute,
as appropriate, in the input whose namespace name is the same as the value of the
<code class="option">from</code> option, in the output its namespace name is</p>
   <div class="itemizedlist">
    
    
   <ul><li>
     <p>replaced with the value of the <code class="option">to</code>
option, provided it is present and not the empty string;</p>
    </li><li>
     <p>otherwise (the <code class="option">to</code> option is
not specified or has an empty string as its value) changed to have no value.</p>
    </li></ul></div>
   <p>If the <code class="option">from</code> option is absent, or its value
   is the empty string, then for every element and attribute, as appropriate,
   whose namespace name has no value, in the
   output its namespace name is set to the value of the
   <code class="option">to</code> option.</p>
  </li><li>
   <p>Namespace attributes:  If the <code class="option">from</code> option is present
and its value is not the empty string, for every namespace attribute in the
input whose value is the same as the value of the <code class="option">from</code> option, in the output</p>
   <div class="itemizedlist">
    
    
   <ul><li>
     <p>the namespace attribute's value is replaced with the value of the <code class="option">to</code>
option, provided it is present and not the empty string;</p>
    </li><li>
     <p>otherwise (the <code class="option">to</code> option is
not specified or has an empty string as its value) the namespace attribute is absent.</p>
    </li></ul></div>
  </li></ul></div>

<div id="note-apply-to" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>The <code class="option">apply-to</code> option is primarily intended to make
it possible to avoid renaming attributes when the <code class="option">from</code> option
specifies no namespace, since many attributes are in no namespace.</p>

<p>Care should be taken when specifying no namespace with the
<code class="option">to</code> option.  Prefixed names in content, for example QNames and
XPath expressions, may end up with no appropriate namespace binding.</p></div></div>

</section>
<section id="c.pack" class="section"><div class="section-titlepage"><h4>1.1.18 p:pack</h4></div>


<p>The <code class="code">p:pack</code> step merges two document sequences in a pair-wise
fashion.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:pack</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">alternate</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>      </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>           </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">wrapper</code> option
<span class="rfc2119" id="c.pack.4.2">must</span> be a <code class="type">QName</code>. If the lexical value
does not contain a colon, then the <code class="tag-attribute">wrapper-namespace</code>
may be used to specify the namespace of the wrapper. In that case, the
<code class="tag-attribute">wrapper-prefix</code> may be specified to suggest a
prefix for the wrapper element.
<a id="err.inline.D0034.3"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>)
to specify a new namespace or prefix if the lexical value of the specified
name contains a colon.</p>

<p>The step takes each pair of documents, in order, one from the
<code class="port">source</code> port and one from the <code class="port">alternate</code> port,
wraps them with a new element node whose QName is the value specified
in the <code class="option">wrapper</code> option, and writes that element to the
<code class="port">result</code> port as a document.</p>

<p>If the step reaches the end of one input sequence before the
other, then it simply wraps each of the remaining documents in the
longer sequence.</p>

<div id="note-two-docs" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>In the common case, where the document element of a document in
the <code class="port">result</code> sequence has two element children, any
comments, processing instructions, or white space text nodes that
occur between them may have come from either of the input documents;
this step does not attempt to distinguish which one.</p>
</div></div>
</section>
<section id="c.parameters" class="section"><div class="section-titlepage"><h4>1.1.19 p:parameters</h4></div>


<p>The <code class="code">p:parameters</code> step exposes a set of parameters
as a <a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:parameters</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>Each parameter in the <code class="option">parameters</code> map is converted into a
<a href="#cv.param"><code class="tag-element">c:param</code></a> element.
The resulting <a href="#cv.param"><code class="tag-element">c:param</code></a> elements are wrapped in a
<a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> and the parameter set document is written
to the <code class="port">result</code> port.
<span id="impl-13">The
order in which <a href="#cv.param"><code class="tag-element">c:param</code></a> elements occur in the <a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> is
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>For consistency and user convenience, if any of the parameters
have names that are in a namespace, the
<code class="tag-attribute">namespace</code> attribute on the
<a href="#cv.param"><code class="tag-element">c:param</code></a> element <span class="rfc2119" id="c.parameters.5.3">must</span> be used. Each
<code class="tag-attribute">name</code> <span class="rfc2119" id="c.parameters.5.5">must</span> be an NCName.</p>

<p>The base URI of the output document is the URI of the pipeline document
that contains the step.</p>

<section id="cv.param" class="section"><div class="section-titlepage"><h5>1.1.19.1 The c:param element</h5></div>


<p>A <code class="tag-element">c:param</code> represents a parameter on a parameter
input.</p>

<p id="d1246e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:param<br />  <strong>name</strong> = <var>QName</var><br />  namespace? = <var>anyURI</var><br />  <strong>value</strong> = <var>string</var> /&gt;</code></p>

<p>The <code class="tag-attribute">name</code> attribute of the
<code class="tag-element">c:param</code> must have the lexical form of a QName.</p>

<p>If the <code class="tag-attribute">namespace</code> attribute is
specified, then the expanded name of the parameter is constructed from
the specified namespace and the <code class="tag-attribute">name</code>
value. <a id="err.inline.D0025"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="../xproc30/#err.D0025"><code class="errqname">err:XD0025</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) if the <code class="tag-attribute">namespace</code>
attribute is specified, the <code class="tag-attribute">name</code> contains
a colon, and the specified namespace is not the same as the in-scope
namespace binding for the specified prefix.
</p>

<p>If the <code class="tag-attribute">namespace</code> attribute is not
specified, and the <code class="tag-attribute">name</code> contains a colon,
then the expanded name of the parameter is constructed using the <code class="tag-attribute">name</code> value and the namespace declarations
in-scope on the <code class="tag-element">c:param</code> element.</p>

<p>If the <code class="tag-attribute">namespace</code> attribute is not
specified, and the <code class="tag-attribute">name</code> does not contain
a colon, then the expanded name of the parameter is in no
namespace.</p>

<p>Any namespace-qualified attribute names that appear on the
<code class="tag-element">c:param</code> element are ignored. <a id="err.inline.D0014"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0014"><code class="errqname">err:XD0014</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) for any unqualified attribute
names other than “<code class="literal">name</code>”,
“<code class="literal">namespace</code>”, or “<code class="literal">value</code>” to
appear on a <code class="tag-element">c:param</code> element.</p>
</section>

<section id="cv.param-set" class="section"><div class="section-titlepage"><h5>1.1.19.2 The c:param-set element</h5></div>


<p>A <code class="tag-element">c:param-set</code> represents a set of parameters on a
parameter input.</p>

<p id="d1273e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:param-set&gt;<br />    <a href="#cv.param">c:param</a>*<br />&lt;/c:param-set&gt;</code></p>

<p>The <code class="tag-element">c:param-set</code> contains zero or more
<a href="#cv.param"><code class="tag-element">c:param</code></a> elements. <a id="err.inline.D0018"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0018"><code class="errqname">err:XD0018</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) if the parameter list contains
any elements other than <a href="#cv.param"><code class="tag-element">c:param</code></a>.</p>

<p>Any namespace-qualified attribute names that appear on the
<code class="tag-element">c:param-set</code> element are ignored. <a id="err.inline.D0014.1"></a>It is
a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0014"><code class="errqname">err:XD0014</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) for any unqualified attribute
names to appear on a <code class="tag-element">c:param-set</code>
element.</p>
</section>

</section>
<section id="c.rename" class="section"><div class="section-titlepage"><h4>1.1.20 p:rename</h4></div>


<p>The <code class="code">p:rename</code> step renames elements, attributes, or
processing-instruction targets in a document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:rename</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">new-name</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">new-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>                  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">new-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>               </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option must be an
XSLTMatchPattern. <a id="err.inline.C0023.4"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the pattern matches anything other than element,
attribute or processing instruction nodes.</p>

<p>The value of the <code class="option">new-name</code> option must be a
<code class="type">QName</code>.
If the lexical value does not contain a colon, then the <code class="tag-attribute">new-namespace</code> may be used to specify the
namespace of the new name. In that case, the <code class="tag-attribute">new-prefix</code> may be specified to suggest a
prefix for the new name. <a id="err.inline.D0034.4"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) to specify a new namespace or
prefix if the lexical value of the specified name contains a
colon.
</p>

<p>Each element, attribute, or processing-instruction in the input
matched by the match pattern specified in the <code class="option">match</code>
option is renamed in the output to the name specified by the
<code class="option">new-name</code> option.</p>

<p>If the <code class="option">match</code> option matches an attribute and if
the element on which it occurs already has an attribute whose expanded
name is the same as the expanded name of the specified
<code class="option">new-name</code>, then the results is as if the current
attribute named “<em class="replaceable"><code>new-name</code></em>” was deleted before
renaming the matched attribute.</p>

<p>With respect to attributes named “<code class="literal">xml:base</code>”, the
following semantics apply: renaming an <em>from</em>
“<code class="literal">xml:base</code>” <em>to</em> something else has
no effect on the underlying base URI of the element; however,
if an attribute is renamed <em>from</em> something else
<em>to</em> “<code class="literal">xml:base</code>”, the base URI
of the element <span class="rfc2119" id="c.rename.8.8">must</span> also be amended accordingly.</p>

<p>If the pattern matches processing instructions, then it is the
processing instruction target that is renamed. <a id="err.inline.C0013"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0013"><code class="errqname">err:XC0013</code></a>) if the pattern matches
a processing instruction and the new name has a non-null namespace.
</p>

</section>
<section id="c.replace" class="section"><div class="section-titlepage"><h4>1.1.21 p:replace</h4></div>


<p>The <code class="code">p:replace</code> step replaces matching nodes in
its primary input with the document element of the
<code class="code">replacement</code> port's document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:replace</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">replacement</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option
<span class="rfc2119" id="c.replace.4.2">must</span> be an XSLTMatchPattern. <a id="err.inline.C0023.5"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches
anything other than element, text, processing-instruction, or comment
nodes.  Multiple matches are allowed, in which case multiple
copies of the <code class="port">replacement</code> document will occur.</p>

<p>Every node in the primary input matching the specified
pattern is replaced in the output is replaced by the document element
of the <code class="port">replacement</code> document. Only non-nested matches are
replaced. That is, once a node is replaced, its descendants cannot
be matched.</p>

</section>
<section id="c.set-attributes" class="section"><div class="section-titlepage"><h4>1.1.22 p:set-attributes</h4></div>


<p>The <code class="tag-element">p:set-attributes</code> step sets attributes on
matching elements.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:set-attributes</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">attributes</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

 <p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.set-attributes.4.2">must</span> be an
 XSLTMatchPattern. <a id="err.inline.C0023.6"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
 error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches anything other than element
 nodes.</p>

<p>Each attribute on the document element of the document that
appears on the <code class="port">attributes</code> port is copied to each element
that matches the <code class="option">match</code> expression.</p>

<p>If an attribute with the same name as one of the attributes to
be copied already exists, the value specified on the
<code class="port">attribute</code> port's document is used. The result port of
this step produces a copy of the <code class="port">source</code> port's document
with the matching elements' attributes modified.</p>

<p>The matching elements are specified by the match pattern in the
<code class="option">match</code> option. All matching elements are processed.
If no elements match, the step will not change any elements.</p>

<p>This step must not copy namespace declarations.  If the attributes
copied from the <code class="port">attributes</code> use namespaces, prefixes, or
prefixes bound to different namespaces, the document produced on the
<code class="port">result</code> output port will require
<span class="xspecref"><a href="../xproc30/#namespace-fixup">Section 2.5.2, “Namespace Fixup on XML Outputs”</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>.</p>

<p>If an attribute named
<code class="tag-attribute">xml:base</code> is added or changed, the base URI
of the element <span class="rfc2119" id="c.set-attributes.9.2">must</span> also be amended accordingly.</p>

</section>
<section id="c.set-properties" class="section"><div class="section-titlepage"><h4>1.1.23 p:set-properties</h4></div>


<p>The <code class="tag-element">p:set-properties</code> step sets <em class="glossterm"><a href="../xproc30/#dt-document-properties">document
properties</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> on the source document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:set-properties</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">properties</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

 <p>The <em class="glossterm"><a href="../xproc30/#dt-document-properties">document properties</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> of the document
on the <code class="port">source</code> port are augmented with the values specified
in the <code class="option">properties</code> option. The document produced on
the <code class="port">result</code> port has the same representation but the
adjusted property values.</p>

<p><a id="err.inline.C1001"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C1001"><code class="errqname">err:XC1001</code></a>) if the <code class="option">properties</code> map contains
a key equal to the string “<code class="literal">content-type</code>”.
</p>

</section>
<section id="c.sink" class="section"><div class="section-titlepage"><h4>1.1.24 p:sink</h4></div>


<p>The <code class="tag-element">p:sink</code> step accepts a sequence of documents and
discards them. It has no output.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:sink</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

</section>
<section id="c.split-sequence" class="section"><div class="section-titlepage"><h4>1.1.25 p:split-sequence</h4></div>


<p>The <code class="tag-element">p:split-sequence</code> step accepts a sequence of
documents and divides it into two sequences.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:split-sequence</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">matched</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">not-matched</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">initial-only</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">test</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>        </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

 <p>The value of the <code class="option">test</code> option <span class="rfc2119" id="c.split-sequence.4.2">must</span> be an XPathExpression.</p>

<p>The XPath expression in the <code class="option">test</code> option is
applied to each document in the input sequence. If the effective
boolean value of the expression is true, the document is copied to the
<code class="port">matched</code> port; otherwise it is copied to the
<code class="port">not-matched</code> port.</p>

<p>If the <code class="option">initial-only</code> option is true, then when
the first document that does not satisfy the test expression is
encountered, it <em>and all the documents that follow
it</em> are written to the <code class="port">not-matched</code> port.
In other words, it only writes the initial series of matched
documents (which may be empty) to the <code class="port">matched</code> port.
All other documents are written to the <code class="port">not-matched</code> port,
irrespective of whether or not they match.</p>

<p>The <span class="xspecref"><a href="../xproc30/#xpath-context">XPath context</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span> for the
<code class="option">test</code> option changes over time. For each document that
appears on the <code class="code">source</code> port, the expression is evaluated
with that document as the context document. The context position
(<code class="code">position()</code>) is the position of that document within the
sequence and the context size (<code class="code">last()</code>) is the total
number of documents in the sequence.</p>

<div id="note-stream" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>In principle, this component cannot stream because it must
buffer all of the input sequence in order to find the context size. In
practice, if the test expression does not use the
<code class="function">last()</code> function, the implementation can stream
and ignore the context size.</p>
</div></div>

<p>If the implementation supports passing PSVI annotations between
steps, the <code class="tag-element">p:split-sequence</code> step <span class="rfc2119" id="c.split-sequence.9.2">must</span> preserve
any annotations that appear in the input.</p>

</section>
<section id="c.store" class="section"><div class="section-titlepage"><h4>1.1.26 p:store</h4></div>


<p>The <code class="tag-element">p:store</code> step stores (a possibly serialized
version of) its input to a URI. This step outputs a reference to the
location of the stored document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:store</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">href</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">byte-order-mark</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">cdata-section-elements</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">''</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">ListOfQNames</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-public</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-system</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">encoding</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">escape-uri-attributes</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-content-type</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">indent</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">media-type</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">method</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'xml'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">normalization-form</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'none'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">NormalizationForm</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">omit-xml-declaration</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">standalone</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'omit'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>   </code><code class="comment">&lt;!-- </code><span class="opt-type">"true" | "false" | "omit"</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">undeclare-prefixes</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'1.0'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">href</code> option
<span class="rfc2119" id="c.store.4.2">must</span> be an <code class="type">anyURI</code>. If it is relative,
it is made absolute against the base URI of the element on which it is
specified (<a href="../xproc30/#p.with-option">p:with-option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> or <code class="tag-element">p:store</code> in the case
of a <span class="xspecref"><a href="../xproc30/#option-shortcut">syntactic shortcut</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>
value).</p>

<p>The step attempts to store the XML document to the specified
URI. <a id="err.inline.C0050"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0050"><code class="errqname">err:XC0050</code></a>)
if the URI scheme is not supported or the step cannot store to the
specified location.</p>

<p>The output of this step is a document containing a single
<a href="#cv.result"><code class="tag-element">c:result</code></a> element whose content is the absolute URI of the
document stored by the step.</p>

<p>The standard serialization options are provided to control the
serialization of XML content when it is stored. These options are
as specified in <a href="#serialization-options" title="Serialization Options">Section 1.3, “Serialization Options”</a>.</p>
</section>
<section id="c.string-replace" class="section"><div class="section-titlepage"><h4>1.1.27 p:string-replace</h4></div>


<p>The <code class="tag-element">p:string-replace</code> step matches nodes in the
document provided on the <code class="port">source</code> port and replaces them
with the string result of evaluating an XPath expression.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:string-replace</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">replace</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>     </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.string-replace.4.2">must</span> be an
XSLTMatchPattern.</p>

<p>The value of the <code class="option">replace</code> option <span class="rfc2119" id="c.string-replace.5.2">must</span> be an
XPathExpression.</p>

<p>The matched nodes are specified with the match pattern in the
<code class="option">match</code> option.
For each matching node, the XPath
expression provided by the <code class="option">replace</code> option is
evaluated with the matching node as the XPath context node.
The string value of the result is used in the output.
Nodes that do not match are copied without change.</p>

<p>If the expression given in the <code class="option">match</code> option
matches an <em>attribute</em>, the string value of the
<code class="option">replace</code>
expression is used as the new value of the attribute in the output.
If the attribute is named “<code class="tag-attribute">xml:base</code>”, the base URI
of the element <span class="rfc2119" id="c.string-replace.7.5">must</span> also be amended accordingly.</p>

<p>If the expression matches any other kind of node, the entire
node (and <em>not</em> just its contents) is replaced by
the string value of the <code class="option">replace</code> expression.</p>
</section>
<section id="c.unescape-markup" class="section"><div class="section-titlepage"><h4>1.1.28 p:unescape-markup</h4></div>


<p>The <code class="tag-element">p:unescape-markup</code> step takes the string value of
the document element and parses the content as if it was a Unicode
character stream containing serialized XML. The output consists of the
same document element with children that result from the parse. This
is the reverse of the <a href="#c.escape-markup"><code class="tag-element">p:escape-markup</code></a> step.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:unescape-markup</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml text/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>                   </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">content-type</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'application/xml'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">encoding</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">charset</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">namespace</code> option
<span class="rfc2119" id="c.unescape-markup.4.2">must</span> be an <code class="type">anyURI</code>. It
<span class="rfc2119" id="c.unescape-markup.4.4">should</span> be absolute, but will not be
resolved.</p>

<p>When the string value is parsed, the original document element
is preserved so that the result will be well-formed XML even if the
content consists of multiple, sibling elements.</p>

<p>The <code class="option">namespace</code> option specifies a default
namespace. Elements that are in no namespace in the unescaped content
will be placed into this namespace unless there is an in-scope namespace
declaration that specifies a different namespace (or explicitly undeclares
the default namespace).</p>

<p>The <code class="option">content-type</code> option <span class="rfc2119" id="c.unescape-markup.7.2">may</span>
be used to specify an alternate content type for the string value. An
implementation <span class="rfc2119" id="c.unescape-markup.7.3">may</span> use a different parser to
produce XML content depending on the specified content-type. For
example, an implementation might provide an HTML to XHTML parser (e.g.
[<a href="#tidy"><span class="abbrev">HTML Tidy</span></a>] or [<a href="#tagsoup"><span class="abbrev">TagSoup</span></a>]) for the
content type '<code class="literal">text/html</code>'.</p>

<p>All implementations <span class="rfc2119" id="c.unescape-markup.8.1">must</span> support the content
type <code class="literal">application/xml</code>, and must use a standard XML
parser for it. <a id="err.inline.C0051"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0051"><code class="errqname">err:XC0051</code></a>) if the content-type specified is not supported by
the implementation.
<span id="impl-14">Behavior of
<code class="tag-element">p:unescape-markup</code> for <code class="option">content-type</code>s other
than <code class="literal">application/xml</code> is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>The <code class="option">encoding</code> option specifies how the data is
encoded. All implementations <span class="rfc2119" id="c.unescape-markup.9.2">must</span> support the
<code class="literal">base64</code> encoding (and the absence of an encoding
option, which implies that the content is plain Unicode text).
<a id="err.inline.C0052.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0052"><code class="errqname">err:XC0052</code></a>) if the
encoding specified is not supported by the
implementation.</p>

<p>If an <code class="option">encoding</code> is specified, a
<code class="option">charset</code> may also be specified.
The character set may be specified as a parameter on the
<code class="option">content-type</code> or via the separate
<code class="option">charset</code> option. If it is specified in both places,
the value of the <code class="option">charset</code> option
<span class="rfc2119" id="c.unescape-markup.10.6">must</span> be used.</p>

<p>If the specified
<code class="option">encoding</code> is <code class="literal">base64</code>,
then the character set
<span class="rfc2119" id="c.unescape-markup.11.3">must</span> be specified.
<a id="err.inline.C0010"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0010"><code class="errqname">err:XC0010</code></a>)
if an encoding of <code class="literal">base64</code> is specified and
the character set is not specified or if the specified
character set is not supported by the implementation.
</p>

<p>The octet-stream that results from decoding the
text <span class="rfc2119" id="c.unescape-markup.12.1">must</span> be interpreted using the character encoding named by
the value of the <code class="option">charset</code> option
to produce a sequence of Unicode characters to parse.</p>

<p>If no <code class="option">encoding</code> is specified, the character set
is ignored, irrespective of where it was specified.</p>

<p>For example, with the 'namespace' option set to the XHTML
namespace, the following input:</p>

<pre class="programlisting language-markup line-numbers"><code>&lt;description&gt;
&amp;lt;p&gt;This is a chunk.&amp;lt;/p&gt;
&amp;lt;p&gt;This is a another chunk.&amp;lt;/p&gt;
&lt;/description&gt;</code></pre>

<p>would produce:</p>

<pre class="programlisting language-markup line-numbers"><code>&lt;description&gt;
&lt;p xmlns="http://www.w3.org/1999/xhtml"&gt;This is a chunk.&lt;/p&gt;
&lt;p xmlns="http://www.w3.org/1999/xhtml"&gt;This is a another chunk.&lt;/p&gt;
&lt;/description&gt;</code></pre>
</section>
<section id="c.unwrap" class="section"><div class="section-titlepage"><h4>1.1.29 p:unwrap</h4></div>


<p>The <code class="tag-element">p:unwrap</code> step replaces matched elements with their
children.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:unwrap</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

 <p>The value of the <code class="option">match</code> option <span class="rfc2119" id="c.unwrap.4.2">must</span> be an
 XSLTMatchPattern. <a id="err.inline.C0023.7"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
 error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if that pattern matches anything other than element
 nodes.</p>

<p>Every element in the <code class="port">source</code> document that matches
the specified <code class="option">match</code> pattern is replaced by its children,
effectively “unwrapping” the children from their parent. Non-element nodes
and unmatched elements are passed through unchanged.</p>

<div id="note-match-doc" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>The matching applies to the entire document, not just the “top-most”
matches. A pattern of the form <code class="literal">h:div</code> will replace
<em>all</em> <code class="tag-element">h:div</code> elements, not just the top-most
ones.</p>
</div></div>

<p>This step produces a single document; if the document element is
unwrapped, the result might not be well-formed XML.</p>
</section>
<section id="c.wrap" class="section"><div class="section-titlepage"><h4>1.1.30 p:wrap</h4></div>


<p>The <code class="tag-element">p:wrap</code> step wraps matching nodes in the
<code class="port">source</code> document with a new parent element.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:wrap</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>      </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>           </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">group-adjacent</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">wrapper</code> option
<span class="rfc2119" id="c.wrap.4.2">must</span> be a <code class="type">QName</code>. If the lexical value
does not contain a colon, then the <code class="tag-attribute">wrapper-namespace</code>
may be used to specify the namespace of the wrapper. In that case, the
<code class="tag-attribute">wrapper-prefix</code> may be specified to suggest a
prefix for the wrapper element.
<a id="err.inline.D0034.5"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>)
to specify a new namespace or prefix if the lexical value of the specified
name contains a colon.</p>

<p>The value of the <code class="option">match</code> option
<span class="rfc2119" id="c.wrap.5.2">must</span> be an XSLTMatchPattern. <a id="err.inline.C0023.8"></a>It
is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0023"><code class="errqname">err:XC0023</code></a>) if the pattern matches
anything other than document, element, text, processing instruction, and comment
nodes.
</p>

<p>The value of the <code class="option">group-adjacent</code> option
<span class="rfc2119" id="c.wrap.6.2">must</span> be an XPathExpression.</p>

<p>If the node matched is the document node (<code class="code">match="/"</code>),
the result is a new document where the document element is a new
element node whose QName is the value specified in the
<code class="option">wrapper</code> option. That new element contains copies of
all of the children of the original document node.</p>

<p>When the match pattern does not match the document node,
every node that matches the specified <code class="option">match</code>
pattern is replaced with a new element node whose QName is the value
specified in the <code class="option">wrapper</code> option.
The content of that new element is a copy of the original,
matching node. The <code class="tag-element">p:wrap</code> step performs a "deep" wrapping, the children
of the matching node and their descendants are processed and wrappers
are added to all matching nodes.
</p>

<p>The <code class="option">group-adjacent</code> option can be used to group
adjacent matching nodes in a single wrapper element. The specified
XPath expression is evaluated for each matching node with that node
as the XPath context node. Whenever two or more adjacent matching nodes
have the same “group adjacent” value, they are wrapped together in
a single wrapper element.</p>

<p>Two matching nodes are considered adjacent if and only if they
are siblings and either there are no nodes between them or all
intervening, non-matching nodes are whitespace text, comment, or processing
instruction nodes.</p>

</section>
<section id="c.wrap-sequence" class="section"><div class="section-titlepage"><h4>1.1.31 p:wrap-sequence</h4></div>


<p>The <code class="tag-element">p:wrap-sequence</code> step accepts a sequence of
documents and produces either a single document or a new sequence of
documents.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:wrap-sequence</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>      </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper-prefix</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:NCName</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrapper-namespace</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>           </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">group-adjacent</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code><code class="comment">&lt;!-- </code><span class="opt-type">XPathExpression</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">wrapper</code> option
<span class="rfc2119" id="c.wrap-sequence.4.2">must</span> be a <code class="type">QName</code>. If the lexical value
does not contain a colon, then the <code class="tag-attribute">wrapper-namespace</code>
may be used to specify the namespace of the wrapper. In that case, the
<code class="tag-attribute">wrapper-prefix</code> may be specified to suggest a
prefix for the wrapper element.
<a id="err.inline.D0034.6"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0034"><code class="errqname">err:XD0034</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>)
to specify a new namespace or prefix if the lexical value of the specified
name contains a colon.</p>

<p>The value of the <code class="option">group-adjacent</code> option
<span class="rfc2119" id="c.wrap-sequence.5.2">must</span> be an XPathExpression.</p>

<p>In its simplest form, <code class="tag-element">p:wrap-sequence</code> takes a
sequence of documents and produces a single, new document by placing
each document in the <code class="port">source</code> sequence inside a new
document element as sequential siblings. The name of the document
element is the value specified in the <code class="option">wrapper</code>
option.</p>

<p>The <code class="option">group-adjacent</code> option can be used to group
adjacent documents.
The
<span class="xspecref"><a href="../xproc30/#xpath-context">XPath
context</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span> for the
<code class="option">group-adjacent</code> option changes over time. For each document that
appears on the <code class="code">source</code> port, the expression is evaluated
with that document as the context document. The context position
(<code class="code">position()</code>) is the position of that document within the
sequence and the context size (<code class="code">last()</code>) is the total
number of documents in the sequence.
Whenever
two or more sequentially adjacent documents have the same “group
adjacent” value, they are wrapped together in a single wrapper
element.
</p>

</section>
<section id="c.xinclude" class="section"><div class="section-titlepage"><h4>1.1.32 p:xinclude</h4></div>


<p>The <code class="tag-element">p:xinclude</code> step applies [<a href="#xinclude"><span class="abbrev">XInclude</span></a>] processing to the <code class="port">source</code> document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xinclude</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">fixup-xml-base</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'false'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">fixup-xml-lang</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'false'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">fixup-xml-base</code> option <span class="rfc2119" id="c.xinclude.4.2">must</span> be a
boolean. If it is true, base URI fixup will be performed as per
[<a href="#xinclude"><span class="abbrev">XInclude</span></a>].</p>

<p>The value of the <code class="option">fixup-xml-lang</code> option <span class="rfc2119" id="c.xinclude.5.2">must</span> be a
boolean. If it is true, language fixup will be performed as per
[<a href="#xinclude"><span class="abbrev">XInclude</span></a>].</p>

<p>The included documents are located with the base URI of the
input document and are not provided as input to the step.</p>

<p><a id="err.inline.C0029"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0029"><code class="errqname">err:XC0029</code></a>)
if an XInclude error occurs during processing. </p>
</section>
<section id="c.xslt" class="section"><div class="section-titlepage"><h4>1.1.33 p:xslt</h4></div>


<p>The <code class="tag-element">p:xslt</code> step applies an
[<a href="#xslt10"><span class="abbrev">XSLT 1.0</span></a>] or
[<a href="#xslt20"><span class="abbrev">XSLT 2.0</span></a>] stylesheet to a document.</p>

<p class="element-syntax element-syntax-declare-step-rqd"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xslt</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">stylesheet</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">secondary</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">initial-mode</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>                 </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">template-name</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>                </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">output-base-uri</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>             </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>If present, the value of the <code class="option">initial-mode</code>
option <span class="rfc2119" id="c.xslt.4.2">must</span> be a <code class="type">QName</code>.</p>

<p>If present, the value of the <code class="option">template-name</code>
option <span class="rfc2119" id="c.xslt.5.2">must</span> be a <code class="type">QName</code>.</p>

<p>If present, the value of the <code class="option">output-base-uri</code>
option <span class="rfc2119" id="c.xslt.6.2">must</span> be an <code class="type">anyURI</code>. If it is
relative, it is made absolute against the base URI of the element on
which it is specified (<a href="../xproc30/#p.with-option">p:with-option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> or <code class="tag-element">p:xslt</code> in the
case of a <span class="xspecref"><a href="../xproc30/#option-shortcut">syntactic shortcut</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>
value).</p>

<p>If the step specifies a <code class="option">version</code>, then that version
of XSLT <span class="rfc2119" id="c.xslt.7.2">must</span> be used to process the transformation.
<a id="err.inline.C0038"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0038"><code class="errqname">err:XC0038</code></a>) if the specified version
is not available. If the step does not specify a version, the
implementation may use any version it has available and may use any means
to determine what version to use, including, but not limited to,
examining the version of the stylesheet.</p>

<p>The XSLT stylesheet provided on the <code class="port">stylesheet</code> port
is applied to the document on the <code class="port">source</code> port. Any
parameters passed in the <code class="option">parameters</code> option are used
to define top-level stylesheet parameters. The primary result document
of the transformation, if there is one, appears on the
<code class="port">result</code> port. At most one document can appear on the
<code class="port">result</code> port. All other result documents appear on the
<code class="port">secondary</code> port. <span id="impl-15">The order in which result documents
appear on the <code class="port">secondary</code> port is
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span> If XSLT 1.0 is
used, an empty sequence of documents <span class="rfc2119" id="c.xslt.8.8">must</span> appear on
the <code class="port">secondary</code> port.</p>

<p>If a sequence of documents is provided on the
<code class="port">source</code> port, the first document is used as the
primary input document. The whole sequence is also the default
collection.
If no documents are provided on the <code class="port">source</code> port,
the primary input document is undefined and the default collection
is empty.
<a id="err.inline.C0039"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0039"><code class="errqname">err:XC0039</code></a>) if a sequence of documents (including
an empty sequence) is provided
to an XSLT 1.0 step.
</p>

<p>A dynamic error occurs if the XSLT processor signals a fatal
error. This includes the case where the transformation terminates due
to a <code class="tag-element">xsl:message</code> instruction with a <code class="tag-attribute">terminate</code> attribute value of
“<code class="literal">yes</code>”. <span id="impl-16">How XSLT message termination
errors are reported to the XProc processor is
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>The invocation of the transformation is controlled by the
<code class="option">initial-mode</code> and <code class="option">template-name</code>
options that set the initial mode and/or named template in the XSLT
transformation where processing begins. <a id="err.inline.C0056"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0056"><code class="errqname">err:XC0056</code></a>) if the specified initial mode
or named template cannot be applied to the specified stylesheet.
</p>

<p>The <code class="option">output-base-uri</code> option sets the context's
output base URI per the XSLT 2.0 specification, otherwise the base URI
of the <code class="port">result</code> document is the base URI of the first
document in the <code class="code">source</code> port's sequence. If the value of
the <code class="option">output-base-uri</code> option is not absolute, it will
be resolved using the base URI of its <a href="../xproc30/#p.option">p:option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>
element. An XSLT 1.0 step <span class="rfc2119" id="c.xslt.12.6">should</span> use the value of the
<code class="option">output-base-uri</code> as the base URI of its output, if the
option is specified.</p>

<p>If XSLT 2.0 is used, the outputs of this step
<span class="rfc2119" id="c.xslt.13.1">may</span> include PSVI annotations.</p>


<p>The static and initial dynamic contexts of the XSLT processor
are the contexts defined in
<span class="xspecref"><a href="../xproc30/#step-xpath-context-20"></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>
with the following adjustments.</p>

<p>The dynamic context is augmented as follows:</p>

<div class="variablelist">




<dl><dt><span class="term">Context item</span></dt><dd>
<p>The first document that appears on the <code class="port">source</code> port.
</p>
</dd><dt><span class="term">Variable values</span></dt><dd>
<p>Any parameters
passed in the <code class="option">parameters</code> option are available as variable bindings
to the XSLT processor.</p>
</dd><dt><span class="term">Function implementations</span></dt><dd>
<p>The function implementations provided by the XSLT processor.</p>
</dd><dt><span class="term">Default collection</span></dt><dd>
<p>The sequence of documents provided on the <code class="port">source</code> port.
</p>
</dd></dl></div>
</section>
</section>

<section id="std-optional" class="section"><div class="section-titlepage"><h3>1.2 Optional Steps</h3></div>


<p>The following steps are optional. If they are supported by a
processor, they must conform to the semantics outlined here, but a
conformant processor is not required to support all (or any) of these
steps.</p>

<section id="c.exec" class="section"><div class="section-titlepage"><h4>1.2.1 p:exec</h4></div>


<p>The <code class="tag-element">p:exec</code> step runs an external command passing the
input that arrives on its <code class="port">source</code> port as standard input,
reading <code class="port">result</code> from standard output, and <code class="port">errors</code>
from standard error.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:exec</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">errors</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">exit-status</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">command</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>     </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">args</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">''</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">cwd</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">source-is-xml</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">result-is-xml</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrap-result-lines</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">errors-is-xml</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">wrap-error-lines</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">path-separator</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">failure-threshold</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer</code><code>"</code><code>/&gt;</code><code>          </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">arg-separator</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">' '</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">byte-order-mark</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>            </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">cdata-section-elements</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">''</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">ListOfQNames</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-public</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">doctype-system</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>              </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">encoding</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">escape-uri-attributes</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">include-content-type</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">indent</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>    </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">media-type</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                  </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">method</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'xml'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">normalization-form</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'none'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code></code><code class="comment">&lt;!-- </code><span class="opt-type">NormalizationForm</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">omit-xml-declaration</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">standalone</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'omit'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>   </code><code class="comment">&lt;!-- </code><span class="opt-type">"true" | "false" | "omit"</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">undeclare-prefixes</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code>         </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'1.0'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>      </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The values of the <code class="option">command</code>, <code class="option">args</code>,
<code class="option">cwd</code>, <code class="option">path-separator</code>, and
<code class="option">arg-separator</code> options <span class="rfc2119" id="c.exec.4.6">must</span> be strings.</p>

<p>The values of the <code class="option">source-is-xml</code>,
<code class="option">result-is-xml</code>, <code class="option">errors-is-xml</code>,
and <code class="option">fix-slashes</code> options <span class="rfc2119" id="c.exec.5.5">must</span> be
boolean.</p>

<p>The <code class="tag-element">p:exec</code> step executes the command passed on
<code class="option">command</code> with the arguments passed on
<code class="option">args</code>. The processor does not interpolate the values
of the <code class="option">command</code> or <code class="option">args</code> (for example,
expanding references to environment variables).
<a id="err.inline.C0033"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0033"><code class="errqname">err:XC0033</code></a>) if the command cannot be run.
</p>

<p>If <code class="option">cwd</code> is specified, then the current working
directory is changed to the value of that option before execution
begins. <a id="err.inline.C0034"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0034"><code class="errqname">err:XC0034</code></a>) if the current working directory cannot be changed
to the value of the <code class="option">cwd</code> option.
<span id="impl-17">If <code class="option">cwd</code> is not
specified, the current working directory is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>If the <code class="option">path-separator</code> option is specified,
every occurrence of the character identified as the
<code class="option">path-separator</code> character that occurs in the
<code class="option">command</code>, <code class="option">args</code>, or
<code class="option">cwd</code> will be replaced by the platform-specific path
separator character. <a id="err.inline.C0063"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0063"><code class="errqname">err:XC0063</code></a>) if the <code class="option">path-separator</code> option is
specified and is not exactly one character long.
</p>

<p>The value of the <code class="option">args</code> option is a string. In
order to support passing more than one argument to a command, the
<code class="option">args</code> string is broken into a sequence of values.
The <code class="option">arg-separator</code> option specifies the character
that is used to separate values; by default it is a single space
<a id="err.inline.C0066"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0066"><code class="errqname">err:XC0066</code></a>) if
the <code class="option">arg-separator</code> option is specified and is not
exactly one character long.
</p>

<p>The following examples of <code class="tag-element">p:exec</code> are equivalent. The
first uses the default <code class="option">arg-separator</code>:</p>

<pre class="programlisting language-markup"><code>&lt;p:exec command="someCommand" args="arg1 arg2 arg3"/&gt;</code></pre>

<p>The second specifies an alternate separator:</p>

<pre class="programlisting language-markup"><code>&lt;p:exec command="someCommand" args="arg1,arg2,arg3"
	arg-separator=","/&gt;</code></pre>

<p>If one of the arguments contains a space (e.g., a filename that
contains a space), then you must specify an alternate separator.</p>

<p>The <code class="port">source</code> port is declared to accept a sequence so that
  it can be empty. If no document appears on the <code class="port">source</code> port, then the
  command receives nothing on standard input. If a document does arrive on the <code class="port">source</code> port,
  it will
be passed to the command as its standard input. <a id="err.inline.D0006"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="../xproc30/#err.D0006"><code class="errqname">err:XD0006</code></a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>) if
more than one document appears on the <code class="port">source</code> port of the <code class="tag-element">p:exec</code> step.
  If
<code class="option">source-is-xml</code> is true, the serialization options are
used to convert the input into serialized XML which is passed to
the command, otherwise the XPath string-value
of the document is passed.</p>

<p>The standard output of the command is read and returned on
<code class="port">result</code>; the standard error output is read and returned on
<code class="port">errors</code>. In order to assure that the result will be an
XML document, each of the results will be wrapped in a <a href="#cv.result"><code class="tag-element">c:result</code></a>
element.</p>

<p>If <code class="option">result-is-xml</code> is true, the standard output of
the program is assumed to be XML and will be parsed as a single document.
If it is false, the output is assumed <em>not</em> to be XML
and will be returned as escaped text.</p>

<p id="cv.line">If <code class="option">wrap-result-lines</code> is
true, a <a href="#cv.line"><code class="tag-element">c:line</code></a> element will be wrapped around each line of output.</p>

<p id="d1646e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:line&gt;<br />    <var>string</var><br />&lt;/c:line&gt;</code></p>

<p><a id="err.inline.C0035"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0035"><code class="errqname">err:XC0035</code></a>) to specify both <code class="option">result-is-xml</code> and
<code class="option">wrap-result-lines</code>.</p>

<p>The same rules apply to the
standard error output of the program, with the <code class="option">errors-is-xml</code>
and <code class="option">wrap-error-lines</code> options, respectively.</p>

<p>If either of the results are XML, they <span class="rfc2119" id="c.exec.22.1">must</span> be
parsed with namespaces enabled and validation turned off, just like
<a href="../xproc30/#p.document">p:document</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>.</p>

<p>The <code class="port">exit-status</code> port always returns a single
<a href="#cv.result"><code class="tag-element">c:result</code></a> element which contains the system exit status that
the process returned. <span id="impl-18">The specific exit status values returned by
a process invoked with <code class="tag-element">p:exec</code> are
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>If a <code class="option">failure-threshold</code> value is supplied, and the
exit status is greater than that threshold, then the <code class="tag-element">p:exec</code>
step <span class="rfc2119" id="c.exec.24.3">must</span> fail.
<a id="err.inline.C0064"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0064"><code class="errqname">err:XC0064</code></a>) if the exit code from the command is greater than
the specified <code class="option">failure-threshold</code> value.
This failure, like any step failure,
can be captured with a <a href="../xproc30/#p.try">p:try</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>.</p>

</section>
<section id="c.hash" class="section"><div class="section-titlepage"><h4>1.2.2 p:hash</h4></div>


<p>The <code class="tag-element">p:hash</code> step generates a hash, or digital “fingerprint”,
for some value and injects it into the <code class="port">source</code> document.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:hash</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">value</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">algorithm</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:QName</code><code>"</code><code>/&gt;</code><code>    </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">algorithm</code> option must be a QName.
If it does not have a prefix, then it must be one of the following values:
“crc”, “md”, or “sha”.</p>

<p>If a <code class="tag-attribute">version</code> is not specified, the
default version is algorithm-defined. For “<code class="literal">crc</code>” it
is 32, for “<code class="literal">md</code>” it is 5, for “<code class="literal">sha</code>”
it is 1.</p>

<p>A hash is constructed from the string specified in the
<code class="option">value</code> option using the specified algorithm and version.
Implementations <span class="rfc2119" id="c.hash.6.2">must</span> support
[<a href="#bib.crc"><span class="abbrev">CRC32</span></a>],
[<a href="#rfc1321"><span class="abbrev">MD5</span></a>], and [<a href="#bib.sha"><span class="abbrev">SHA1</span></a>]
hashes. <span id="impl-19">It is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> what other algorithms are
supported.</span>
The resulting hash <span class="rfc2119" id="c.hash.6.7">should</span> be returned as a string of
hexadecimal characters.
</p>

<p>The value of the <code class="option">match</code> option must be an
XSLTMatchPattern.</p>

<p>The hash of the specified value is computed using the algorithm and
parameters specified. <a id="err.inline.C0036"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0036"><code class="errqname">err:XC0036</code></a>) if the requested hash algorithm is not
one that the processor understands or if the value or parameters are
not appropriate for that algorithm.</p>

<p>The matched nodes are specified with the match pattern in the
<code class="option">match</code> option. For each matching node, the string
value of the computed hash is used in the output (if more than one node
matches, the <em>same</em> hash value is used in each match).
Nodes that do not
match are copied without change.</p>

<p>If the expression given in the <code class="option">match</code> option
matches an <em>attribute</em>, the hash is used as the new
value of the attribute in the output.
If the attribute is named “<code class="tag-attribute">xml:base</code>”, the base URI
of the element <span class="rfc2119" id="c.hash.10.4">must</span> also be amended accordingly.</p>

<p>If the expression matches any
other kind of node, the entire node (and <em>not</em> just
its contents) is replaced by the hash.</p>
</section>
<section id="c.in-scope-names" class="section"><div class="section-titlepage"><h4>1.2.3 p:in-scope-names</h4></div>


<p>The <code class="code">p:in-scope-names</code> step exposes all of the
in-scope variables and options as a set of parameters in a
<a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> document.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:in-scope-names</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">false</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>Each in-scope variable and option is converted into a
<a href="#cv.param"><code class="tag-element">c:param</code></a> element.
The resulting <a href="#cv.param"><code class="tag-element">c:param</code></a> elements are wrapped in a 
<a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> and the parameter set document is written
to the <code class="port">result</code> port.
<span id="impl-20">The
order in which <a href="#cv.param"><code class="tag-element">c:param</code></a> elements occur in the <a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> is
<em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>For consistency and user convenience, if any of the variables or options
have names that are in a namespace, the
<code class="tag-attribute">namespace</code> attribute on the
<a href="#cv.param"><code class="tag-element">c:param</code></a> element <span class="rfc2119" id="c.in-scope-names.5.3">must</span> be used. Each
<code class="tag-attribute">name</code> <span class="rfc2119" id="c.in-scope-names.5.5">must</span> be an NCName.</p>

<p>The base URI of the output document is the URI of the pipeline document
that contains the step.</p>

<p>For consistency with the <a href="#c.parameters"><code class="tag-element">p:parameters</code></a> step, the
<code class="port">result</code> port is not primary.</p>

<section id="ex-in-scope-names" class="section tocsuppress"><div class="section-titlepage"><h5>1.2.3.1 Example</h5></div>


<p>This unlikely pipeline demonstrates the behavior of <a href="#c.in-scope-names"><code class="tag-element">p:in-scope-names</code></a>:
</p>

<pre class="programlisting language-none line-numbers"><code>&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc"
                name="main" version="1.0"&gt;
&lt;p:output port="result"&gt;
  &lt;p:pipe step="vars" port="result"/&gt;
&lt;/p:output&gt;

&lt;p:option name="username" required="true"/&gt;
&lt;p:option name="password" required="true"/&gt;
&lt;p:variable name="host" select="'http://example.com/'"/&gt;

&lt;p:in-scope-names name="vars"/&gt;

&lt;/p:declare-step&gt;</code></pre>

<p>Assuming the values supplied for the username and password
options are “<code class="literal">user</code>” and “<code class="literal">pass</code>”,
respectively, the output would be:</p>

<pre class="programlisting language-none line-numbers"><code>&lt;c:param-set xmlns:c="http://www.w3.org/ns/xproc-step"&gt;
  &lt;c:param name="username" namespace="" value="user"/&gt;
  &lt;c:param name="host" namespace="" value="http://example.com/"/&gt;
  &lt;c:param name="password" namespace="" value="pass"/&gt;
&lt;/c:param-set&gt;</code></pre>

</section>
</section>
<section id="c.template" class="section ext-optional"><div class="section-titlepage"><h4>1.2.4 p:template</h4></div>


<p>The <code class="code">p:template</code> replaces each XPath expression, delimited with
curly braces, in the <code class="port">template</code> document with the result of evaluating that
expression.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:template</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">template</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>While evaluating each expression, the names of any parameters passed to the
step are available as variable values in the XPath dynamic context.</p>

<p>The step searches for XPath expressions in attribute values,
text content (adjacent text nodes, if they occur in the data model,
must be coalesced; this step always processes maximal length text
nodes), processing instruction data, and comments. XPath expressions
are identified by curly braces, similar to attribute value templates
in XSLT or enclosed expressions in XQuery.</p>

<p>In order to allow curly braces to appear literally in content, they can be escaped
by doubling them. In other words, where “<code class="code">{</code>” would start an XPath expression,
“<code class="code">{{</code>” is simply a <em>single</em>, literal opening curly brace.
The same applies for closing curly braces.</p>

<p>Inside an XPath expression, strings quoted by single (<code class="code">'</code>) or
double (<code class="code">"</code>) quotes are treated literally. Outside of quoted text, it
is an error for an opening curly brace to occur. A closing curly brace ends the
XPath expression (whether or not it is followed immediately by another closing
curly brace).</p>

<p>These parsing rules can be described by the following algorithm, though implementations
are by no means required to implement the parsing in exactly this way, provided that they
achieve the same results.</p>

<div class="itemizedlist">




<ul><li><p>The parser begins in <em>regular-mode</em> at the start of
each unit of content where expansion may occur. In <em>regular-mode</em>:
</p>
<div class="orderedlist">




<ol style="list-style: decimal;"><li><p>“<code class="code">{{</code>” is replaced by a single “<code class="code">{</code>”.</p></li><li><p>“<code class="code">}}</code>” is replaced by a single “<code class="code">}</code>”.
</p>
<p>Note:
<a id="err.inline.C0067"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0067"><code class="errqname">err:XC0067</code></a>) to
encounter a single closing curly brace “<code class="code">}</code>” that is not immediately
followed by another closing curly brace.
</p></li><li><p>A single opening curly brace “<code class="code">{</code>” (not
immediately followed by another opening curly brace) is discarded and
the parser moves into <em>xpath-mode</em>. The inital expression is empty.
</p></li><li><p>All other characters are copied without change.</p></li></ol></div>
</li><li>
<p>In <em>xpath-mode</em>:</p>
<div class="orderedlist">





<ol style="list-style: decimal;"><li><p><a id="err.inline.C0067.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0067"><code class="errqname">err:XC0067</code></a>) to
encounter an opening curly brace “<code class="code">{</code>”.</p></li><li><p>A closing curly brace “<code class="code">}</code>” is discarded and ends the
expression. The expression is evaluated and the result of that
evaluation is copied to the output. The parser returns to
<em>regular-mode</em>.</p>
<p>Note: Braces cannot be escaped by doubling them
in <em>xpath-mode</em>.</p></li><li><p>A single quote (<code class="code">'</code>) is added to the current expression and
the parser moves to <em>single-quote-mode</em>.</p></li><li><p>A double quote (<code class="code">"</code>) is added to the current expression and
the parser moves to <em>double-quote-mode</em>.</p></li><li><p>All other characters are appended to the current expression.</p></li></ol></div>
</li><li>
<p>In <em>single-quote-mode</em>:</p>
<div class="orderedlist">


<ol style="list-style: decimal;"><li><p>A single quote (<code class="code">'</code>) is added to the current expression and
the parser moves to <em>xpath-mode</em>.</p></li><li><p>All other characters are appended to the current expression.</p></li></ol></div>
</li><li>
<p>In <em>double-quote-mode</em>:</p>
<div class="orderedlist">


<ol style="list-style: decimal;"><li><p>A double quote (<code class="code">"</code>) is added to the current expression and
the parser moves to <em>xpath-mode</em>.</p></li><li><p>All other characters are appended to the current expression.</p></li></ol></div>
</li></ul></div>

<p><a id="err.inline.C0067.2"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0067"><code class="errqname">err:XC0067</code></a>) if the parser reaches
the end of the unit of content and it is not in <em>regular-mode</em>.
</p>

<p>The context node used for each expression is the document passed on the
<code class="port">source</code> port.
<a id="err.inline.C0068"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0068"><code class="errqname">err:XC0068</code></a>)
if more than one document appears on the <code class="port">source</code> port.
In an XPath 1.0 implementation, if
<a href="../xproc30/#p.empty">p:empty</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> is given or implied on the <code class="port">source</code> port, an
empty document node is used as
the context node. In an XPath 2.0 implementation, the context item is
undefined.
<a id="err.inline.C0026"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0026"><code class="errqname">err:XC0026</code></a>) if
any XPath expression makes reference to the context node, size, or
position when the context item is undefined.</p>

<p>In an attribute value, processing instruction, or comment, the
string value of the XPath expression is used. In text content, an
expression that selects nodes will cause those nodes to be copied into
the template document.</p>

<div id="note-xpath-version" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>Depending on which version of XPath an implementation supports,
and possibly on the <code class="tag-attribute">xpath-version</code> setting on
the <code class="tag-element">p:template</code>, some implementations may report errors, or
different results, than other implementations in those cases where the
interpretation of an XPath expression differs between the versions of
XPath.</p>
</div></div>

<section id="ex-template" class="section tocsuppress"><div class="section-titlepage"><h5>1.2.4.1 Example</h5></div>


<p>It's quite common to construct documents using values computed
by the pipeline. This is particularly (but not exclusively) the case
when the pipeline uses the <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> step. The input
to <a href="#c.http-request"><code class="tag-element">p:http-request</code></a> is a <a href="#cv.request"><code class="tag-element">c:request</code></a> document;
attributes on the <a href="#cv.request"><code class="tag-element">c:request</code></a> element control most of the
request parameters; the body of the document forms the body of
request.</p>

<p>A typical example looks like this:</p>

<pre class="programlisting language-none line-numbers"><code>&lt;c:request method="POST" href="http://example.com/post"
           username="user" password="password"&gt;
&lt;c:body&gt;
  &lt;computed-content/&gt;
&lt;/c:body&gt;
&lt;/c:request&gt;</code></pre>

<p>If we assume that the <code class="tag-attribute">href</code> value and the computed
content come from an input document, and the username and password are options, then a
typical pipeline to compute the request becomes quite complex.</p>

<pre class="programlisting language-none line-numbers"><code>&lt;p:pipeline xmlns:p="http://www.w3.org/ns/xproc"
            xmlns:c="http://www.w3.org/ns/xproc-step"
            name="main" version="1.0"&gt;
&lt;p:option name="username" required="true"/&gt;
&lt;p:option name="password" required="true"/&gt;

&lt;p:identity&gt;
  &lt;p:input port="source"&gt;
    &lt;p:inline&gt;
      &lt;c:request method="POST"/&gt;
    &lt;/p:inline&gt;
  &lt;/p:input&gt;
&lt;/p:identity&gt;

&lt;p:add-attribute match="/c:request" attribute-name="href"&gt;
  &lt;p:with-option name="attribute-value" select="/doc/request/@uri"&gt;
    &lt;p:pipe step="main" port="source"/&gt;
  &lt;/p:with-option&gt;
&lt;/p:add-attribute&gt;

&lt;p:add-attribute match="/c:request" attribute-name="username"&gt;
  &lt;p:with-option name="attribute-value" select="$username"/&gt;
&lt;/p:add-attribute&gt;

&lt;p:add-attribute match="/c:request" attribute-name="password"&gt;
  &lt;p:with-option name="attribute-value" select="$password"/&gt;
&lt;/p:add-attribute&gt;

&lt;p:insert position="first-child" match="/c:request"&gt;
  &lt;p:input port="insertion" select="/doc/request"&gt;
    &lt;p:pipe step="main" port="source"/&gt;
  &lt;/p:input&gt;
&lt;/p:insert&gt;

&lt;p:unwrap match="/c:request/request"/&gt;

&lt;/p:pipeline&gt;</code></pre>

<p>There's nothing wrong with this pipeline, but it requires
several steps to accomplish with the pipeline author probably
considers a single operation. What's more, the result of these steps
is not immediately obvious on casual inspection.</p>

<p>In order to make this simple construction case both literally
and conceptually simpler, this note introduces two new XProc steps in
the XProc namespace. Support for these steps is optional, but we
strongly encourage implementors to provide them.</p>

<p>The new steps are <a href="#c.in-scope-names"><code class="tag-element">p:in-scope-names</code></a> and
<a href="#c.template"><code class="tag-element">p:template</code></a>. Taken together, they greatly simplify
the pipeline:</p>

<pre class="programlisting language-none line-numbers"><code>&lt;p:pipeline xmlns:p="http://www.w3.org/ns/xproc"
            xmlns:c="http://www.w3.org/ns/xproc-step"
            name="main" version="1.0"&gt;
&lt;p:option name="username" required="true"/&gt;
&lt;p:option name="password" required="true"/&gt;

&lt;p:in-scope-names name="vars"/&gt;

&lt;p:template&gt;
  &lt;p:input port="template"&gt;
    &lt;p:inline&gt;
      &lt;c:request method="POST" href="{/doc/request/@uri}"
                 username="{$username}" password="{$password}"&gt;
        { /doc/request/node() }
      &lt;/c:request&gt;
    &lt;/p:inline&gt;
  &lt;/p:input&gt;
  &lt;p:input port="source"&gt;
    &lt;p:pipe step="main" port="source"/&gt;
  &lt;/p:input&gt;
  &lt;p:input port="parameters"&gt;
    &lt;p:pipe step="vars" port="result"/&gt;
  &lt;/p:input&gt;
&lt;/p:template&gt;

&lt;/p:pipeline&gt;</code></pre>

<p>The <a href="#c.in-scope-names"><code class="tag-element">p:in-scope-names</code></a> step provides all of the in-scope options and variables
in a <a href="#cv.param-set"><code class="tag-element">c:param-set</code></a> (this operation is exactly analagous to what the
<a href="#c.parameters"><code class="tag-element">p:parameters</code></a> step does, except that it operates on the options and variables instead
of on parameters).</p>

<p>The <a href="#c.template"><code class="tag-element">p:template</code></a> step searches for XPath
expressions, delimited by curly braces, in a template document and replaces each with the
result of evaluating the expression. All of the parameters passed to the
<a href="#c.template"><code class="tag-element">p:template</code></a> step are available as in-scope variable names when evaluating
each XPath expression.</p>

<p>Where the expressions occur in attribute values, their string value is used. Where
they appear in text content, their node values are used.</p>

</section>
</section>
<section id="c.uuid" class="section"><div class="section-titlepage"><h4>1.2.5 p:uuid</h4></div>


<p>The <code class="tag-element">p:uuid</code> step generates a
[<a href="#bib.uuid"><span class="abbrev">UUID</span></a>] and injects it into
the <code class="port">source</code> document.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:uuid</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:integer</code><code>"</code><code>/&gt;</code><code>                    </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option must be an
XSLTMatchPattern. The value of the <code class="option">version</code> option
must be an integer.</p>

<p>If the <code class="option">version</code> is specified, that version of
UUID must be computed. <a id="err.inline.C0060"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0060"><code class="errqname">err:XC0060</code></a>) if the processor does not support the specified
<code class="option">version</code> of the UUID algorithm. <span id="impl-21">If the
<code class="option">version</code> is not specified, the version of UUID
computed is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>Implementations <span class="rfc2119" id="c.uuid.6.1">must</span> support version 4 UUIDs.
<span id="impl-22">Support for other versions of UUID, and the mechanism by which
the necessary inputs are made available for computing other versions,
is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>

<p>The matched nodes are specified with the match pattern in the
<code class="option">match</code> option. For each matching node, the generated
UUID is used in the output (if more than one node matches, the
<em>same</em> UUID is used in each match). Nodes that do not
match are copied without change.</p>

<p>If the expression given in the <code class="option">match</code> option
matches an <em>attribute</em>, the UUID is used as the new
value of the attribute in the output. If the attribute is named “<code class="tag-attribute">xml:base</code>”, the base URI of the element
<span class="rfc2119" id="c.uuid.8.4">must</span> also be amended accordingly.</p>

<p>If the expression matches any
other kind of node, the entire node (and <em>not</em> just
its contents) is replaced by the UUID.</p>
</section>
<section id="c.validate-with-relax-ng" class="section"><div class="section-titlepage"><h4>1.2.6 p:validate-with-relax-ng</h4></div>


<p>The <code class="tag-element">p:validate-with-relax-ng</code> step applies
[<a href="#iso19757-2"><span class="abbrev">RELAX NG</span></a>]
validation to the <code class="port">source</code> document.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:validate-with-relax-ng</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">schema</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml */*+xml text/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">dtd-attribute-values</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">dtd-id-idref-warnings</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">assert-valid</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The values of the <code class="option">dtd-attribute-values</code> and
<code class="option">dtd-id-idref-warnings</code> options
<span class="rfc2119" id="c.validate-with-relax-ng.4.3">must</span> be booleans.</p>

<p>If the <code class="port">schema</code> document has an XML media type, then
it <span class="rfc2119" id="c.validate-with-relax-ng.5.2">must</span> be interpreted as a RELAX NG Grammar. If
the <code class="port">schema</code> document has the media type
“<code class="literal">application/relax-ng-compact-syntax</code>” or the media
type has a “<code class="literal">text</code>” type, then it
<span class="rfc2119" id="c.validate-with-relax-ng.5.6">must</span> be interpreted as a [<a href="#relaxng-compact-syntax"><span class="abbrev">RELAX NG
Compact Syntax</span></a>] document for validation.</p>

<p>If the <code class="option">dtd-attribute-values</code> option is
<code class="literal">true</code>, then the attribute value defaulting conventions of
[<a href="#relaxng-dtd-compat"><span class="abbrev">RELAX NG DTD Compatibility</span></a>] are also applied.</p>

<p>If the <code class="option">dtd-id-idref-warnings</code> option is
<code class="literal">true</code>, then the validator <span class="rfc2119" id="c.validate-with-relax-ng.7.3">should</span>
treat a schema that is incompatible with the ID/IDREF/IDREFs feature
of [<a href="#relaxng-dtd-compat"><span class="abbrev">RELAX NG DTD Compatibility</span></a>] as if the document
was invalid.
</p>

<p><a id="err.inline.C0053"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0053"><code class="errqname">err:XC0053</code></a>)
if the <code class="option">assert-valid</code> option is <code class="literal">true</code>
and the input document is not valid.</p>

<p>The output from this step is a copy of the input, possibly
augmented by application of the
[<a href="#relaxng-dtd-compat"><span class="abbrev">RELAX NG DTD Compatibility</span></a>]. The output of this step
<span class="rfc2119" id="c.validate-with-relax-ng.9.2">may</span> include PSVI annotations.</p>

<p><span id="impl-23">Support for [<a href="#relaxng-dtd-compat"><span class="abbrev">RELAX NG DTD Compatibility</span></a>] is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

</section>
<section id="c.validate-with-schematron" class="section"><div class="section-titlepage"><h4>1.2.7 p:validate-with-schematron</h4></div>


<p>The <code class="tag-element">p:validate-with-schematron</code> step applies
[<a href="#iso19757-3"><span class="abbrev">Schematron</span></a>]
processing to the <code class="port">source</code> document.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:validate-with-schematron</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">schema</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">report</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">phase</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'#ALL'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">assert-valid</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p><a id="err.inline.C0054"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0054"><code class="errqname">err:XC0054</code></a>)
if the <code class="option">assert-valid</code> option is <code class="literal">true</code>
and any Schematron assertions fail.</p>

<p>The value of the <code class="option">phase</code> option identifies the
Schematron validation phase with which validation begins.</p>

<p>The <code class="option">parameters</code> option provides name/value pairs which
correspond to Schematron external variables.</p>

<p>The <code class="port">result</code> output from this step is a copy of the
input.</p>

<p>Schematron assertions and reports, if any,
<span class="rfc2119" id="c.validate-with-schematron.8.1">must</span> appear on the <code class="port">report</code> port. The
output <span class="rfc2119" id="c.validate-with-schematron.8.3">should</span> be in <em class="citetitle">Schematron
Validation Report Language</em> (SVRL).</p>

<p>The output of this step
<span class="rfc2119" id="c.validate-with-schematron.9.1">may</span> include PSVI annotations.</p>
</section>
<section id="c.validate-with-xml-schema" class="section"><div class="section-titlepage"><h4>1.2.8 p:validate-with-xml-schema</h4></div>


<p>The <code class="tag-element">p:validate-with-xml-schema</code> step applies
[<a href="#xmlschema-1"><span class="abbrev">W3C XML Schema: Part 1</span></a>]
validity assessment to the <code class="port">source</code> input.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:validate-with-xml-schema</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">schema</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">use-location-hints</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">try-namespaces</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">false()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">assert-valid</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">true()</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:boolean</code><code>"</code><code>/&gt;</code><code></code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">mode</code><code>"</code> <code class="attr select-attr">select</code><code>="</code><code class="value select-value">'strict'</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:token</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">"strict" | "lax"</span><code class="comment"> --&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The values of the <code class="option">use-location-hints</code>,
<code class="option">try-namespaces</code>, and
<code class="option">assert-valid</code>
options
 <span class="rfc2119" id="c.validate-with-xml-schema.4.4">must</span> be boolean.</p>

<p>The value of the <code class="option">mode</code> option
<span class="rfc2119" id="c.validate-with-xml-schema.5.2">must</span> be an NMTOKEN whose value is either
“<code class="literal">strict</code>” or “<code class="literal">lax</code>”.</p>

<p>Validation is performed against the set of schemas represented
by the documents on the <code class="port">schema</code> port. These schemas must
be used in preference to any schema locations provided by schema
location hints encountered during schema validation, that is, schema
locations supplied for <code class="code">xs:import</code> or
<code class="code">xsi:schema-location</code>, or determined by
schema-processor-defined namespace-based strategies, for the
namespaces covered by the documents available on the schemas port.</p>

<p>If <code class="code">xs:include</code> elements occur within the supplied
schema documents, they are treated like any other
<span class="xspecref"><a href="../xproc30/#external-docs">external
documents</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>. <span id="impl-24">It is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em> if the documents supplied
on the <code class="port">schemas</code> port are considered when resolving
<code class="code">xs:include</code> elements in the schema documents provided.</span>
</p>

<p>The <code class="option">use-location-hints</code> and
<code class="option">try-namespaces</code> options allow the pipeline author to
control how the schema processor should attempt to locate schema
documents necessary but not provided on the <code class="port">schema</code>
port. Any schema documents provided on the <code class="port">schema</code> port
<span class="rfc2119" id="c.validate-with-xml-schema.8.5">must</span> be used in preference to schema documents
located by other means.</p>

<p>If the <code class="option">use-location-hints</code> option is
“<code class="literal">true</code>”, the processor <span class="rfc2119" id="c.validate-with-xml-schema.9.3">should</span>
make use of schema location hints to locate schema documents. If the
option is “<code class="literal">false</code>”, the processor
<span class="rfc2119" id="c.validate-with-xml-schema.9.5">should</span> ignore any such hints.</p>

<p>If the <code class="option">try-namespaces</code> option is
“<code class="literal">true</code>”, the processor <span class="rfc2119" id="c.validate-with-xml-schema.10.3">should</span>
attempt to dereference the namespace URI to locate schema documents.
If the
option is “<code class="literal">false</code>”, the processor
<span class="rfc2119" id="c.validate-with-xml-schema.10.5">should not</span> dereference namespace URIs.</p>

<p>The <code class="option">mode</code> option allow the pipeline author to
control how schema validation begins. The “<code class="literal">strict</code>”
mode means that the document element must be declared and
schema-valid, otherwise it will be treated as invalid. The
“<code class="literal">lax</code>” mode means that the
absence of a declaration for the document element does not itself
count as an unsuccessful outcome of validation.</p>

<p>If the step specifies a <code class="option">version</code>, then that version
of XML Schema <span class="rfc2119" id="c.validate-with-xml-schema.12.2">must</span> be used to process the validation.
<a id="err.inline.C0038.1"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0038"><code class="errqname">err:XC0038</code></a>) if the specified version
is not available. If the step does not specify a version, the
implementation may use any version it has available and may use any means
to determine what version to use, including, but not limited to,
examining the version of the schema(s).</p>

<p><a id="err.inline.C0053.1"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0053"><code class="errqname">err:XC0053</code></a>)
if the <code class="option">assert-valid</code> option is <code class="literal">true</code>
and the input document is not valid. If the <code class="option">assert-valid</code>
option is <code class="literal">false</code>, it is not an error for the document
to be invalid. In this case, if the implementation does not
support the PSVI, <code class="tag-element">p:validate-with-xml-schema</code> is essentially
just an “identity” step, but if the implementation <em>does</em>
support the PSVI, then the resulting document will have additional type
information (at least for the subtrees that are valid).</p>

<p>When XML Schema validation assessment
is performed, the processor is invoked in the mode specified by the
<code class="option">mode</code> option.
<a id="err.inline.C0055"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0055"><code class="errqname">err:XC0055</code></a>)
if the implementation does not support the specified mode.
</p>

<p>The <code class="port">result</code> of the assessment is a document with the
Post-Schema-Validation-Infoset (PSVI) ([<a href="#xmlschema-1"><span class="abbrev">W3C XML Schema: Part 1</span></a>]) annotations, if the pipeline implementation
supports such annotations. If not, the input document is reproduced
with any defaulting of attributes and elements performed as specified
by the XML Schema recommendation.</p>
</section>
<section id="c.www-form-urldecode" class="section"><div class="section-titlepage"><h4>1.2.9 p:www-form-urldecode</h4></div>


<p>The <code class="tag-element">p:www-form-urldecode</code> step decodes a
<code class="literal">x-www-form-urlencoded</code> string into an XML representation.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:www-form-urldecode</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">value</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The <code class="option">value</code> option is interpreted as a string of
parameter values encoded using the
<code class="literal">x-www-form-urlencoded</code> algorithm. Each name/value
pair is written in a <a href="#cv.param"><code class="tag-element">c:param</code></a> element.
The entire set of parameters
is written (as a <a href="#cv.param-set"><code class="tag-element">c:param-set</code></a>) on the <code class="port">result</code>
output port.</p>

<p><a id="err.inline.C0037"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0037"><code class="errqname">err:XC0037</code></a>) if the <code class="option">value</code> provided
is not a properly
<code class="literal">x-www-form-urlencoded</code> value.
<a id="err.inline.C0061"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0061"><code class="errqname">err:XC0061</code></a>) if the name of any encoded parameter
name is not a valid <code class="type">xs:NCName</code>. In other words, this
step can only decode simple name/value pairs where the names do not contain
colons or any characters that cannot be used in XML names.
</p>

<p>The order of the <a href="#cv.param"><code class="tag-element">c:param</code></a> elements in the result is the same
as the order of the encoded parameters, reading from left to right.</p>

<p>If any parameter name occurs more than once in the encoded string,
the resulting parameter set will contain a <a href="#cv.param"><code class="tag-element">c:param</code></a> for
each instance.</p>

</section>
<section id="c.www-form-urlencode" class="section"><div class="section-titlepage"><h4>1.2.10 p:www-form-urlencode</h4></div>


<p>The <code class="tag-element">p:www-form-urlencode</code> step encodes a set of parameter
values as a <code class="literal">x-www-form-urlencoded</code> string and
injects it into the <code class="port">source</code> document.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:www-form-urlencode</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">match</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>       </code><code class="comment">&lt;!-- </code><span class="opt-type">XSLTMatchPattern</span><code class="comment"> --&gt;</code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">match</code> option must be an
XSLTMatchPattern.</p>

<p>The set of parameters is encoded as a single
<code class="literal">x-www-form-urlencoded</code> string of name/value pairs.
When parameters are encoded into name/value pairs,
<em>only</em> the local name of each parameter is used.
The namespace name is ignored and no prefix or colon appears in the name.
</p>

<p><span id="impl-25">The order of the parameters is
is <em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>The matched nodes are specified with the match pattern in the
<code class="option">match</code> option. For each matching node, the encoded
string is used in the output. Nodes that do not
match are copied without change.</p>

<p>If the expression given in the <code class="option">match</code> option
matches an <em>attribute</em>, the encoded
string is used as the new value of the attribute in the output.
If the expression matches any other kind of node, the entire
node (and <em>not</em> just its contents) is replaced by
the encoded string.</p>
</section>
<section id="c.xquery" class="section"><div class="section-titlepage"><h4>1.2.11 p:xquery</h4></div>


<p>The <code class="tag-element">p:xquery</code> step applies an
[<a href="#xquery10"><span class="abbrev">XQuery 1.0</span></a>] query to the sequence of documents
provided on the <code class="port">source</code> port.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xquery</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr primary-attr">primary</code><code>="</code><code class="value primary-value">true</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">query</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml */*+xml text/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr sequence-attr">sequence</code><code>="</code><code class="value sequence-value">true</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">version</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                     </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>If a sequence of documents is provided on the
<code class="port">source</code> port, the first document is used as the
initial context item. The whole sequence is also the default
collection. If no documents are provided on the <code class="port">source</code> port,
the initial context item is undefined and the default collection
is empty.</p>

<p>The <code class="port">query</code> port must receive a single document:</p>

<div class="itemizedlist">







<ul><li>
<p>If the document root element is <a href="#cv.query"><code id="cv.query" class="tag-element">c:query</code></a>, the text
descendants of this element are considered the query.</p>
<p id="d1929e0" class="element-syntax element-syntax-step-vocabulary"><code>&lt;c:query&gt;<br />    <var>string</var><br />&lt;/c:query&gt;</code></p>
</li><li>
<p>If the document root element is in the XQueryX namespace, the
document is treated as an XQueryX-encoded query. <span id="impl-26">Support for
XQueryX is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>
</li><li>
<p>If the <code class="port">query</code> document has an XML media type, then
the string value of the document <span class="rfc2119" id="c.xquery.6.3.1.2">must</span> be treated as
the query. If the media type has a “<code class="literal">text</code>” type,
then it <span class="rfc2119" id="c.xquery.6.3.1.4">must</span> be interpreted as the query.</p>
</li><li>
<p><span id="impl-27">Otherwise, the interpretation of the query
is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>
</li></ul></div>

<p>If the step specifies a <code class="option">version</code>, then that version
of XQuery <span class="rfc2119" id="c.xquery.7.2">must</span> be used to process the transformation.
<a id="err.inline.C0038.2"></a>It is a
<em class="glossterm"><a href="#dt-dynamic-error">dynamic error</a></em> (<a href="#err.C0038"><code class="errqname">err:XC0038</code></a>) if the specified version
is not available. If the step does not specify a version, the
implementation may use any version it has available and may use any means
to determine what version to use, including, but not limited to,
examining the version of the query.</p>

<p>The result of the <code class="tag-element">p:xquery</code> step must be a sequence of
documents. <a id="err.inline.C0057"></a>It is a <em class="glossterm"><a href="#dt-dynamic-error">dynamic
error</a></em> (<a href="#err.C0057"><code class="errqname">err:XC0057</code></a>) if the sequence that results from evaluating the XQuery contains
items other than documents and elements. Any elements that appear
in the result sequence will be treated as documents with the element as their
document element.</p>

<p>For example:</p>
<pre class="programlisting language-markup line-numbers"><code>
&lt;c:query&gt;
declare namespace atom="http://www.w3.org/2005/Atom";
/atom:feed/atom:entry
&lt;/c:query&gt;

</code></pre>

<p>The output of this step
<span class="rfc2119" id="c.xquery.11.1">may</span> include PSVI annotations.</p>

<p>The static context of the XQuery processor is augmented in the following
way:</p>

<div class="variablelist">


<dl><dt><span class="term">Statically known default collection type</span></dt><dd>
<p><code class="literal">document()*</code></p>
</dd><dt><span class="term">Statically known namespaces:</span></dt><dd>
<p>Unchanged from the implementation defaults. No namespace declarations
in the XProc pipeline are automatically exposed in the static context.
</p>
</dd></dl></div>

<p>The dynamic context of the XQuery processor is augmented in the following
way:</p>

<div class="variablelist">










<dl><dt><span class="term">Context item</span></dt><dd>
<p>The first document that appears on the <code class="port">source</code> port.
</p>
</dd><dt><span class="term">Context position</span></dt><dd>
<p><code class="literal">1</code>
</p>
</dd><dt><span class="term">Context size</span></dt><dd>
<p><code class="literal">1</code>
</p>
</dd><dt><span class="term">Variable values</span></dt><dd>
<p>Any parameters passed in the <code class="option">parameters</code> option
augment any implementation-defined variable bindings known to the XQuery
processor.
</p>
</dd><dt><span class="term">Function implementations</span></dt><dd>
<p>The function implementations provided by the XQuery processor.</p>
</dd><dt><span class="term">Current dateTime</span></dt><dd>
<p><span id="impl-28">The point in time returned as the current dateTime is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>
</dd><dt><span class="term">Implicit timezone</span></dt><dd>
<p><span id="impl-29">The implicit timezone is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.
</span>
</p>
</dd><dt><span class="term">Available documents</span></dt><dd>
<p><span id="impl-30">The set of available documents (those that may be retrieved with a URI)
is <em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>
</dd><dt><span class="term">Available collections</span></dt><dd>
<p><span id="impl-31">The set of available collections
is <em class="glossterm"><a href="../xproc30/#dt-implementation-dependent">implementation-dependent</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>
</dd><dt><span class="term">Default collection</span></dt><dd>
<p>The sequence of documents provided on the <code class="port">source</code> port.
</p>
</dd></dl></div>

<section id="example-xquery" class="section tocsuppress"><div class="section-titlepage"><h5>1.2.11.1 Example</h5></div>


<p>The following pipeline applies XInclude processing and schema
validation before using XQuery:</p>

<figure id="ex.c.xquery" class="example-wrapper"><div class="title">Example 1. A Sample Pipeline Document</div><div class="example"><pre class="programlisting language-markup line-numbers"><code>&lt;p:pipeline xmlns:p="http://www.w3.org/ns/xproc" version="1.0"&gt;

&lt;p:xinclude/&gt;

&lt;p:validate-with-xml-schema name="validate"&gt;
  &lt;p:input port="schema"&gt;
    &lt;p:document href="http://example.com/path/to/schema.xsd"/&gt;
  &lt;/p:input&gt;
&lt;/p:validate-with-xml-schema&gt;

&lt;p:xquery&gt;
   &lt;p:input port="query"&gt;
      &lt;p:data href="countp.xq" /&gt;
   &lt;/p:input&gt;
&lt;/p:xquery&gt;

&lt;/p:pipeline&gt;</code></pre></div></figure>

<p>Where <code class="filename">countp.xq</code> might contain:</p>

<pre class="programlisting language-markup"><code>&lt;count&gt;{count(.//p)}&lt;/count&gt;</code></pre>

</section>
</section>
<section id="c.xsl-formatter" class="section"><div class="section-titlepage"><h4>1.2.12 p:xsl-formatter</h4></div>


<p>The <code class="tag-element">p:xsl-formatter</code> step receives an [<a href="#xsl11"><span class="abbrev">XSL 1.1</span></a>] document and renders the content. The result of
rendering is stored to the URI provided via the <code class="option">href</code>
option. A reference to that result is produced on the output
port.</p>

<p class="element-syntax element-syntax-declare-step-opt"><span class="decl"><code>&lt;p:declare-step</code> <code class="attr type-attr">type</code><code>="</code><code class="value type-value">p:xsl-formatter</code><code>"</code><code>&gt;</code></span><br />     <span class="input"><code>&lt;p:input</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">source</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">application/xml text/xml */*+xml</code><code>"</code><code>/&gt;</code></span><br />     <span class="input"><code>&lt;p:output</code> <code class="attr port-attr">port</code><code>="</code><code class="value port-value">result</code><code>"</code> <code class="attr content-types-attr">content-types</code><code>="</code><code class="value content-types-value">*/*</code><code>"</code><code>/&gt;</code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">parameters</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">map(xs:QName,item())</code><code>"</code><code>/&gt;</code><code>       </code></span><br />     <span class="opt-req"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">href</code><code>"</code> <code class="attr required-attr">required</code><code>="</code><code class="value required-value">true</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:anyURI</code><code>"</code><code>/&gt;</code><code>        </code></span><br />     <span class="opt-opt"><code>&lt;p:option</code> <code class="attr name-attr">name</code><code>="</code><code class="value name-value">content-type</code><code>"</code> <code class="attr as-attr">as</code><code>="</code><code class="value as-value">xs:string</code><code>"</code><code>/&gt;</code><code>                </code></span><br /><code>&lt;/p:declare-step&gt;</code></p>

<p>The value of the <code class="option">href</code> option
<span class="rfc2119" id="c.xsl-formatter.4.2">must</span> be an <code class="type">anyURI</code>. If it is relative,
it is made absolute against the base URI of the element on which it is
specified (<a href="../xproc30/#p.with-option">p:with-option</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> or <code class="tag-element">p:xsl-formatter</code> in the
case of a <span class="xspecref"><a href="../xproc30/#option-shortcut">syntactic shortcut</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></span>
value).</p>

<p>The content-type of the output is controlled by the
<code class="option">content-type</code> option. This option specifies a media
type as defined by [<a href="#media-types"><span class="abbrev">IANA Media Types</span></a>]. The option may
include media type parameters as well (e.g.
"application/someformat; charset=UTF-8"). <span id="impl-32">The use of media type
parameters on the <code class="option">content-type</code> option is
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p><span id="impl-33">If the <code class="option">content-type</code> option is not specified,
the output type is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span> The default <span class="rfc2119" id="c.xsl-formatter.6.2">should</span> be
PDF.</p>

<p><span id="impl-34">A formatter may take any number of optional rendering
parameters via the step's <code class="option">parameters</code>; such parameters
are defined by the XSL implementation used and are
<em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span></p>

<p>The output of this step is a document containing a single
<a href="#cv.result"><code class="tag-element">c:result</code></a> element whose content is the absolute URI of the
document stored by the step.</p>
</section>
</section>

<section id="serialization-options" class="section"><div class="section-titlepage"><h3>1.3 Serialization Options</h3></div>


<p>Several steps in this step library require serialization options
to control the serialization of XML. These options are used to control
serialization as in the [<a href="#xml-serialization"><span class="abbrev">Serialization</span></a>]
specification.</p>

<p>The following options may be present on steps that perform
serialization:</p>

<div class="variablelist">





























<dl><dt><span class="term"><code class="option">byte-order-mark</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.1.2.1.1">must</span> be a boolean.
If it's not specified, the default varies by encoding: for UTF-16 it's
true, for all others, it's false.</p>
</dd><dt><span class="term"><code class="option">cdata-section-elements</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.2.2.1.1">must</span> be a list of
<code class="type">QName</code>s. They are interpreted as elements name.</p>
</dd><dt><span class="term"><code class="option">doctype-public</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.3.2.1.1">must</span> be a string.
The public identifier of the doctype.</p>
</dd><dt><span class="term"><code class="option">doctype-system</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.4.2.1.1">must</span> be an
<code class="type">anyURI</code>. The system identifier of the doctype. It need not
be absolute, and is not resolved.</p>
</dd><dt><span class="term"><code class="option">encoding</code></span></dt><dd>
<p>A character set name. <span id="impl-35">If no <code class="option">encoding</code> is
specified, the encoding used is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation
defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>. If the <code class="option">method</code> is
“<code class="literal">xml</code>” or “<code class="literal">xhtml</code>”, the
implementation defined encoding <span class="rfc2119" id="serialization-options.4.5.2.1.1.6">must</span> be either
UTF-8 or UTF-16.</span></p>
</dd><dt><span class="term"><code class="option">escape-uri-attributes</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.6.2.1.1">must</span> be a
boolean. It is ignored unless the specified method is
“<code class="literal">xhtml</code>” or “<code class="literal">html</code>”.</p>
</dd><dt><span class="term"><code class="option">include-content-type</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.7.2.1.1">must</span> be a boolean.
It is ignored unless the specified method is
“<code class="literal">xhtml</code>” or “<code class="literal">html</code>”.</p>
</dd><dt><span class="term"><code class="option">indent</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.8.2.1.1">must</span> be a
boolean.</p>
</dd><dt><span class="term"><code class="option">media-type</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.9.2.1.1">must</span> be a string. It
specifies the media type (MIME content type). If not specified, the
default varies according to the <code class="option">method</code>:</p>

<div class="variablelist">




<dl><dt><span class="term"><code class="literal">xml</code></span></dt><dd><p><code class="literal">application/xml</code></p></dd><dt><span class="term"><code class="literal">html</code></span></dt><dd><p><code class="literal">text/html</code></p></dd><dt><span class="term"><code class="literal">xhtml</code></span></dt><dd><p><code class="literal">application/xhtml+xml</code></p></dd><dt><span class="term"><code class="literal">text</code></span></dt><dd><p><code class="literal">text/plain</code></p></dd></dl></div>

<p><span id="impl-36">For methods other than <code class="literal">xml</code>, <code class="literal">html</code>,
<code class="literal">xhtml</code>, and <code class="literal">text</code>; the
<code class="option">media-type</code> is <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.
</span></p>
</dd><dt><span class="term"><code class="option">method</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.10.2.1.1">must</span> be a
<code class="type">QName</code>. It specifies the serialization method.</p>
</dd><dt><span class="term"><code class="option">normalization-form</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.11.2.1.1">must</span> be an NMTOKEN,
one of the enumerated values <code class="code">NFC</code>, <code class="code">NFD</code>,
<code class="code">NFKC</code>, <code class="code">NFKD</code>, <code class="code">fully-normalized</code>,
<code class="code">none</code> or an implementation-defined value.</p>
</dd><dt><span class="term"><code class="option">omit-xml-declaration</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.12.2.1.1">must</span> be a
boolean.</p>
</dd><dt><span class="term"><code class="option">standalone</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.13.2.1.1">must</span> be an NMTOKEN,
one of the enumerated values <code class="code">true</code>, <code class="code">false</code>, or
<code class="code">omit</code>.</p>
</dd><dt><span class="term"><code class="option">undeclare-prefixes</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.14.2.1.1">must</span> be a
boolean.</p>
</dd><dt><span class="term"><code class="option">version</code></span></dt><dd>
<p>The value of this option <span class="rfc2119" id="serialization-options.4.15.2.1.1">must</span> be a
string.</p>
</dd></dl></div>

<p>In order to be consistent with the rest of this specification,
boolean values for the serialization parameters must use one of the
XML Schema lexical forms for boolean: "true", "false", "1", or "0".
This is different from the [<a href="#xml-serialization"><span class="abbrev">Serialization</span></a>]
  specification which uses “yes” and “no”. No change in
semantics is implied by this different spelling.</p>

<p>The <code class="option">method</code> option controls the serialization
method used by this component with standard values of 'html', 'xml',
'xhtml', and 'text' but only the 'xml' value is required to be
supported. The interpretation of the remaining options is as
specified in [<a href="#xml-serialization"><span class="abbrev">Serialization</span></a>].</p>

<p><span id="impl-37">Implementations may support other method values but their
results are <em class="glossterm"><a href="../xproc30/#dt-implementation-defined">implementation-defined</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup></em>.</span>
</p>

<p>A minimally conforming implementation must support the
<code class="code">xml</code> output method with the following option
values:</p>

<div class="itemizedlist">
   
   
   
<ul><li><p>The <code class="code">version</code> must support the value <code class="code">1.0</code>.</p></li><li><p>The <code class="code">encoding</code> must support the values <code class="code">UTF-8</code>.</p></li><li><p>The <code class="code">omit-xml-declaration</code> must be supported.  If the value is not specified or has the value <code class="code">no</code>, an XML declaration must be produced.</p></li></ul></div>

<p>All other option values may be ignored for the <code class="code">xml</code>
output method.</p>

<p>If a processor chooses to implement an option for serialization,
it must conform to the semantics defined in the [<a href="#xml-serialization"><span class="abbrev">Serialization</span></a>] specification.</p>

<div id="note-use-char-maps" class="note admonition"><h3>Note</h3><div class="admonition-body">
<p>The use-character-maps parameter in [<a href="#xml-serialization"><span class="abbrev">Serialization</span></a>] specification has not been provided in
the standard serialization options provided by this
specification.</p>
</div></div>
</section>
</section>

<section id="errors" class="section"><div class="section-titlepage"><h2>2 Errors</h2></div>

    <p>Errors in a pipeline can be divided into two classes: static errors and dynamic
      errors.</p>
    <section id="static-errors" class="section"><div class="section-titlepage"><h3>2.1 Static Errors</h3></div>
      
      <p><span id="dt-static-error" class="termdef">[Definition: A <em class="glossterm">static error</em> is one which can
          be detected before pipeline evaluation is even attempted.]</span> Examples of static
        errors include cycles and incorrect specification of inputs and outputs. </p>
      <p>Static errors are fatal and must be detected before any steps are evaluated.</p>
      <p>For a complete list of static errors, see <a href="../xproc30/#app.static-errors">Section 1, “Static Errors”</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>.</p>
    </section>
    <section id="dynamic-errors" class="section"><div class="section-titlepage"><h3>2.2 Dynamic Errors</h3></div>
      
      <p>A <span id="dt-dynamic-error" class="termdef">[Definition: A <em class="glossterm">dynamic error</em> is one which
          occurs while a pipeline is being evaluated.]</span> Examples of dynamic errors include
        references to URIs that cannot be resolved, steps which fail, and pipelines that exhaust the
        capacity of an implementation (such as memory or disk space).</p>
      <p>If a step fails due to a dynamic error, failure propagates upwards until either a
          <a href="../xproc30/#p.try">p:try</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup> is encountered or the entire pipeline fails. In other words, outside of a
          <a href="../xproc30/#p.try">p:try</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>, step failure causes the entire pipeline to fail.</p>
      <p>For a complete list of dynamic errors, see <a href="../xproc30/#app.dynamic-errors">Section 2, “Dynamic Errors”</a><sup class="xrefspec"><a href="../xproc30/">XP</a></sup>.</p>
    </section>
    <section id="step-errors" class="section"><div class="section-titlepage"><h3>2.3 Step Errors</h3></div>
      
      <p>Several of the steps in the standard and option step library can generate dynamic
        errors.</p>
      <p>For a complete list of the dynamic errors raised by builtin pipeline steps, see <a href="#app.step-errors" title="Step Errors">Appendix A, <i>Step Errors</i></a>.</p>
    </section>
  </section>
<article id="app.step-errors" class="appendix"><header class="appendix-titlepage"><h2>A Step Errors</h2></header>


<p>The following <em class="glossterm"><a href="#dt-dynamic-error">dynamic errors</a></em>
can be raised by steps in this specification:</p>

<div id="step-error-summary"><h5>Step Errors</h5><dl class="errs"><dt id="err.C0002"><code class="errqname">err:XC0002</code></dt><dd><p>It is a dynamic error if the value
starts with the string “--”.</p><p>See: <a href="#err.inline.C0002">Request Entity body conversion</a></p></dd><dt id="err.C0003"><code class="errqname">err:XC0003</code></dt><dd><p>It
is a dynamic error if a username
or password is specified without specifying an
auth-method, if
the requested
auth-method isn't supported, or the authentication
challenge contains an authentication method that isn't
supported.</p><p>See: <a href="#err.inline.C0003">Specifying a request</a></p></dd><dt id="err.C0004"><code class="errqname">err:XC0004</code></dt><dd><p>It is a dynamic error if the
status-only attribute has the value true and
the detailed attribute does not have the value true.</p><p>See: <a href="#err.inline.C0004">Specifying a request</a></p></dd><dt id="err.C0005"><code class="errqname">err:XC0005</code></dt><dd><p>It is a dynamic error if the
request contains a c:body or c:multipart but the
method does not allow for an entity body being sent with the request.</p><p>See: <a href="#err.inline.C0005">Specifying a request</a></p></dd><dt id="err.C0006"><code class="errqname">err:XC0006</code></dt><dd><p>It is a dynamic error if the
method is not specified on a c:request.
</p><p>See: <a href="#err.inline.C0006">Specifying a request</a></p></dd><dt id="err.C0010"><code class="errqname">err:XC0010</code></dt><dd><p>It is a dynamic error
if an encoding of base64 is specified and
the character set is not specified or if the specified
character set is not supported by the implementation.</p><p>See: <a href="#err.inline.C0010">p:unescape-markup</a></p></dd><dt id="err.C0012"><code class="errqname">err:XC0012</code></dt><dd><p>It is a
dynamic error if the contents of the directory
path are not available to the step due to access restrictions in the
environment in which the pipeline is run.</p><p>See: <a href="#err.inline.C0012">p:directory-list</a></p></dd><dt id="err.C0013"><code class="errqname">err:XC0013</code></dt><dd><p>It
is a dynamic error if the pattern matches
a processing instruction and the new name has a non-null namespace.</p><p>See: <a href="#err.inline.C0013">p:rename</a></p></dd><dt id="err.C0014"><code class="errqname">err:XC0014</code></dt><dd><p>It is a dynamic error
if the XML namespace (http://www.w3.org/XML/1998/namespace)
or the XMLNS namespace (http://www.w3.org/2000/xmlns/) is
the value of either the from option or the
to option.</p><p>See: <a href="#err.inline.C0014">p:namespace-rename</a></p></dd><dt id="err.C0017"><code class="errqname">err:XC0017</code></dt><dd><p>It is a
dynamic error if the absolute path does not
identify a directory.</p><p>See: <a href="#err.inline.C0017">p:directory-list</a></p></dd><dt id="err.C0019"><code class="errqname">err:XC0019</code></dt><dd><p>It is a dynamic error
if the documents are not equal, and the value of the
fail-if-not-equal option is
true.</p><p>See: <a href="#err.inline.C0019">p:compare</a></p></dd><dt id="err.C0020"><code class="errqname">err:XC0020</code></dt><dd><p>It is a
dynamic error if the the user specifies a value
or values that are inconsistent with each other or with the requirements
of the step or protocol.</p><p>See: <a href="#err.inline.C0020">Specifying a request</a></p></dd><dt id="err.C0022"><code class="errqname">err:XC0022</code></dt><dd><p>it is a dynamic error if
the content of the c:body element does not consist of
exactly one element, optionally preceded and/or followed by any number
of processing instructions, comments or whitespace characters</p><p>See: <a href="#err.inline.C0022">Request Entity body conversion</a></p></dd><dt id="err.C0023"><code class="errqname">err:XC0023</code></dt><dd><p>It
is a dynamic error if the match pattern does
not match an element.</p><p>See: <a href="#err.inline.C0023">p:add-attribute</a>, <a href="#err.inline.C0023.1">p:insert</a>, <a href="#err.inline.C0023.2">p:label-elements</a>, <a href="#err.inline.C0023.3">p:make-absolute-uris</a>, <a href="#err.inline.C0023.4">p:rename</a>, <a href="#err.inline.C0023.5">p:replace</a>, <a href="#err.inline.C0023.6">p:set-attributes</a>, <a href="#err.inline.C0023.7">p:unwrap</a>, <a href="#err.inline.C0023.8">p:wrap</a></p></dd><dt id="err.C0025"><code class="errqname">err:XC0025</code></dt><dd><p>It is a dynamic error
if the match pattern matches anything other than an element node and
the value of the position option is
“first-child” or
“last-child”.</p><p>See: <a href="#err.inline.C0025">p:insert</a></p></dd><dt id="err.C0026"><code class="errqname">err:XC0026</code></dt><dd><p>It is a dynamic error if
any XPath expression makes reference to the context node, size, or
position when the context item is undefined.</p><p>See: <a href="#err.inline.C0026">p:template</a></p></dd><dt id="err.C0028"><code class="errqname">err:XC0028</code></dt><dd><p>it is a
dynamic error if the content of the
c:body element does not consist entirely of
characters</p><p>See: <a href="#err.inline.C0028">Request Entity body conversion</a></p></dd><dt id="err.C0029"><code class="errqname">err:XC0029</code></dt><dd><p>It is a dynamic error
if an XInclude error occurs during processing.</p><p>See: <a href="#err.inline.C0029">p:xinclude</a></p></dd><dt id="err.C0030"><code class="errqname">err:XC0030</code></dt><dd><p>It is a dynamic error if the
override-content-type value cannot be used (e.g.
text/plain to override
image/png).</p><p>See: <a href="#err.inline.C0030">Managing the response</a></p></dd><dt id="err.C0033"><code class="errqname">err:XC0033</code></dt><dd><p>It is a dynamic
error if the command cannot be run.</p><p>See: <a href="#err.inline.C0033">p:exec</a></p></dd><dt id="err.C0034"><code class="errqname">err:XC0034</code></dt><dd><p>It is a dynamic
error if the current working directory cannot be changed
to the value of the cwd option.</p><p>See: <a href="#err.inline.C0034">p:exec</a></p></dd><dt id="err.C0035"><code class="errqname">err:XC0035</code></dt><dd><p>It is a dynamic
error to specify both result-is-xml and
wrap-result-lines.</p><p>See: <a href="#err.inline.C0035">p:exec</a></p></dd><dt id="err.C0036"><code class="errqname">err:XC0036</code></dt><dd><p>It is a
dynamic error if the requested hash algorithm is not
one that the processor understands or if the value or parameters are
not appropriate for that algorithm.</p><p>See: <a href="#err.inline.C0036">p:hash</a></p></dd><dt id="err.C0037"><code class="errqname">err:XC0037</code></dt><dd><p>It is a
dynamic error if the value provided
is not a properly
x-www-form-urlencoded value.</p><p>See: <a href="#err.inline.C0037">p:www-form-urldecode</a></p></dd><dt id="err.C0038"><code class="errqname">err:XC0038</code></dt><dd><p>It is a
dynamic error if the specified version
is not available.</p><p>See: <a href="#err.inline.C0038">p:xslt</a>, <a href="#err.inline.C0038.1">p:validate-with-xml-schema</a>, <a href="#err.inline.C0038.2">p:xquery</a></p></dd><dt id="err.C0039"><code class="errqname">err:XC0039</code></dt><dd><p>It is a
dynamic error if a sequence of documents (including
an empty sequence) is provided
to an XSLT 1.0 step.</p><p>See: <a href="#err.inline.C0039">p:xslt</a></p></dd><dt id="err.C0040"><code class="errqname">err:XC0040</code></dt><dd><p>It is a dynamic error
if the document element of the document that arrives on the
source port is not c:request.</p><p>See: <a href="#err.inline.C0040">p:http-request</a></p></dd><dt id="err.C0050"><code class="errqname">err:XC0050</code></dt><dd><p>It is a dynamic error
if the URI scheme is not supported or the step cannot store to the
specified location.</p><p>See: <a href="#err.inline.C0050">p:store</a></p></dd><dt id="err.C0051"><code class="errqname">err:XC0051</code></dt><dd><p>It is a dynamic
error if the content-type specified is not supported by
the implementation.</p><p>See: <a href="#err.inline.C0051">p:unescape-markup</a></p></dd><dt id="err.C0052"><code class="errqname">err:XC0052</code></dt><dd><p>It is a dynamic
error if the encoding specified is not supported by the
implementation.</p><p>See: <a href="#err.inline.C0052">Request Entity body conversion</a>, <a href="#err.inline.C0052.1">p:unescape-markup</a></p></dd><dt id="err.C0053"><code class="errqname">err:XC0053</code></dt><dd><p>It is a dynamic error
if the assert-valid option is true
and the input document is not valid.</p><p>See: <a href="#err.inline.C0053">p:validate-with-relax-ng</a>, <a href="#err.inline.C0053.1">p:validate-with-xml-schema</a></p></dd><dt id="err.C0054"><code class="errqname">err:XC0054</code></dt><dd><p>It is a dynamic error
if the assert-valid option is true
and any Schematron assertions fail.</p><p>See: <a href="#err.inline.C0054">p:validate-with-schematron</a></p></dd><dt id="err.C0055"><code class="errqname">err:XC0055</code></dt><dd><p>It is a dynamic error
if the implementation does not support the specified mode.</p><p>See: <a href="#err.inline.C0055">p:validate-with-xml-schema</a></p></dd><dt id="err.C0056"><code class="errqname">err:XC0056</code></dt><dd><p>It is a
dynamic error if the specified initial mode
or named template cannot be applied to the specified stylesheet.</p><p>See: <a href="#err.inline.C0056">p:xslt</a></p></dd><dt id="err.C0057"><code class="errqname">err:XC0057</code></dt><dd><p>It is a dynamic
error if the sequence that results from evaluating the XQuery contains
items other than documents and elements.</p><p>See: <a href="#err.inline.C0057">p:xquery</a></p></dd><dt id="err.C0058"><code class="errqname">err:XC0058</code></dt><dd><p>It is a dynamic error
if the all and relative options are
both true.</p><p>See: <a href="#err.inline.C0058">p:add-xml-base</a></p></dd><dt id="err.C0059"><code class="errqname">err:XC0059</code></dt><dd><p>It is a dynamic error if the QName
value in the attribute-name option uses the prefix
“xmlns”
or any other prefix that resolves to the namespace name
http://www.w3.org/2000/xmlns/.
</p><p>See: <a href="#err.inline.C0059">p:add-attribute</a></p></dd><dt id="err.C0060"><code class="errqname">err:XC0060</code></dt><dd><p>It is a dynamic
error if the processor does not support the specified
version of the UUID algorithm.</p><p>See: <a href="#err.inline.C0060">p:uuid</a></p></dd><dt id="err.C0061"><code class="errqname">err:XC0061</code></dt><dd><p>It is a
dynamic error if the name of any encoded parameter
name is not a valid xs:NCName.</p><p>See: <a href="#err.inline.C0061">p:www-form-urldecode</a></p></dd><dt id="err.C0062"><code class="errqname">err:XC0062</code></dt><dd><p>It is a dynamic error if the
match option matches a namespace node.</p><p>See: <a href="#err.inline.C0062">p:delete</a></p></dd><dt id="err.C0063"><code class="errqname">err:XC0063</code></dt><dd><p>It is a dynamic
error if the path-separator option is
specified and is not exactly one character long.</p><p>See: <a href="#err.inline.C0063">p:exec</a></p></dd><dt id="err.C0064"><code class="errqname">err:XC0064</code></dt><dd><p>It is a dynamic
error if the exit code from the command is greater than
the specified failure-threshold value.</p><p>See: <a href="#err.inline.C0064">p:exec</a></p></dd><dt id="err.C0066"><code class="errqname">err:XC0066</code></dt><dd><p>It is a dynamic error if
the arg-separator option is specified and is not
exactly one character long.</p><p>See: <a href="#err.inline.C0066">p:exec</a></p></dd><dt id="err.C0067"><code class="errqname">err:XC0067</code></dt><dd><p>It is a dynamic error to
encounter a single closing curly brace “}” that is not immediately
followed by another closing curly brace.</p><p>See: <a href="#err.inline.C0067">p:template</a>, <a href="#err.inline.C0067.1">p:template</a>, <a href="#err.inline.C0067.2">p:template</a></p></dd><dt id="err.C0068"><code class="errqname">err:XC0068</code></dt><dd><p>It is a dynamic error
if more than one document appears on the source port.</p><p>See: <a href="#err.inline.C0068">p:template</a></p></dd><dt id="err.C1001"><code class="errqname">err:XC1001</code></dt><dd><p>It is a dynamic
error if the properties map contains
a key equal to the string “content-type”.</p><p>See: <a href="#err.inline.C1001">p:set-properties</a></p></dd><dt id="err.C1002"><code class="errqname">err:XC1002</code></dt><dd><p>It is a dynamic
error if the supplied content-type is not
a valid media type of the form
“type/subtype+ext”.</p><p>See: <a href="#err.inline.C1002">p:cast-content-type</a></p></dd><dt id="err.C1003"><code class="errqname">err:XC1003</code></dt><dd><p>It is a dynamic
error if the p:cast-content-type step
cannot perform the requested cast.</p><p>See: <a href="#err.inline.C1003">p:cast-content-type</a></p></dd><dt id="err.C1004"><code class="errqname">err:XC1004</code></dt><dd><p>It is a dynamic
error if the c:data contains content is not
a valid base64 string.</p><p>See: <a href="#err.inline.C1004">p:cast-content-type</a></p></dd><dt id="err.C1005"><code class="errqname">err:XC1005</code></dt><dd><p>It is a dynamic
error if the c:data element does not have
a content-type attribute.</p><p>See: <a href="#err.inline.C1005">p:cast-content-type</a></p></dd><dt id="err.C1006"><code class="errqname">err:XC1006</code></dt><dd><p>It is a dynamic
error if the content-type is supplied and is
not the same as the content-type specified on
the c:data element.</p><p>See: <a href="#err.inline.C1006">p:cast-content-type</a></p></dd><dt id="err.C1007"><code class="errqname">err:XC1007</code></dt><dd><p>In all cases except when the input document
is a c:data element, it is a dynamic
error if the content-type is not supplied.</p><p>See: <a href="#err.inline.C1007">p:cast-content-type</a></p></dd></dl></div>
</article>

<article id="credits" class="appendix"><header class="appendix-titlepage"><h2>B Credits</h2></header>


<p>This document is derived from
<a href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc:
An XML Pipeline Language</a> published by the W3C. It was developed
by the <em class="citetitle">XML Processing Model Working Group</em> and edited by
Norman Walsh, Alex Miłowski, and Henry Thompson.</p>

<p>The editors of this specification extend their gratitude to everyone
who contributed to this document and all of the versions that came before it.</p>
</article>

<article id="references" class="appendix"><header class="appendix-titlepage"><h2>C References</h2></header>



<section id="normative-references" class="section"><div class="section-titlepage"><h2>1 Normative References</h2></div>


<div id="normative-references.2" class="bibliolist">


<div id="xproc20" class="bibliomixed"><p>[<span class="abbrev">XProc 2.0</span>] 
<a href="http://www.w3.org/TR/xproc20/"><span class="citetitle"><cite>XProc 2.0:
An XML Pipeline Language</cite></span></a>.
Norman Walsh, Alex Milowski, and Henry Thompson, editors.
W3C Working Draft 15 December 2014.
</p></div>











<div id="xslt10" class="bibliomixed"><p>[<span class="abbrev">XSLT 1.0</span>] 
<a href="http://www.w3.org/TR/xslt"><span class="citetitle"><cite>XSL Transformations (XSLT)
Version 1.0</cite></span></a>. James Clark, editor.
W3C Recommendation. 16 November 1999.</p></div>


   




<div id="xpath-functions" class="bibliomixed"><p>[<span class="abbrev">XPath 2.0 Functions and Operators</span>] 
<a href="http://www.w3.org/TR/xpath-functions/"><span class="citetitle"><cite>XQuery 1.0 and
XPath 2.0 Functions and Operators</cite></span></a>.
Ashok Malhotra, Jim Melton, and Norman Walsh, editors.
W3C Recommendation. 23 January 2007.</p></div>

<div id="xslt20" class="bibliomixed"><p>[<span class="abbrev">XSLT 2.0</span>] 
<a href="http://www.w3.org/TR/xslt20/"><span class="citetitle"><cite>XSL Transformations (XSLT)
Version 2.0</cite></span></a>. Michael Kay, editor.
W3C Recommendation. 23 January 2007.</p></div>

<div id="xsl11" class="bibliomixed"><p>[<span class="abbrev">XSL 1.1</span>] 
<a href="http://www.w3.org/TR/xsl/"><span class="citetitle"><cite>Extensible Stylesheet
Language (XSL) Version 1.1</cite></span></a>.
Anders Berglund, editor. W3C Recommendation. 5 December 2006.</p></div>

<div id="xquery10" class="bibliomixed"><p>[<span class="abbrev">XQuery 1.0</span>] 
<a href="http://www.w3.org/TR/xquery/"><span class="citetitle"><cite>XQuery 1.0: An XML
Query Language</cite></span></a>. Scott Boag, Don Chamberlin, Mary Fernández, et. al.,
editors. W3C Recommendation. 23 January 2007.</p></div>

<div id="iso19757-2" class="bibliomixed"><p>[<span class="abbrev">RELAX NG</span>] ISO/IEC JTC 1/SC 34.
<a href="http://www.iso.org/iso/iso_catalogue/catalogue_tc/catalogue_detail.htm?csnumber=52348"><span class="citetitle"><cite>ISO/IEC 19757-2:2008(E)
Document Schema Definition Language (DSDL) -- Part 2:
Regular-grammar-based
validation -- RELAX NG</cite></span></a>
2008.
</p></div>

<div id="relaxng-compact-syntax" class="bibliomixed"><p>[<span class="abbrev">RELAX NG
Compact Syntax</span>] ISO/IEC JTC 1/SC 34.
<span class="citetitle"><cite>ISO/IEC 19757-2:2003/Amd 1:2006 Document Schema Definition
Languages (DSDL) — Part 2: Grammar-based validation — RELAX NG AMENDMENT 1
Compact Syntax</cite></span>
2006.
</p></div>

<div id="relaxng-dtd-compat" class="bibliomixed"><p>[<span class="abbrev">RELAX NG DTD Compatibility</span>] 
<span class="citetitle"><cite>RELAX NG DTD Compatibility</cite></span>.
OASIS Committee Specification.
3 December 2001.
</p></div>

<div id="iso19757-3" class="bibliomixed"><p>[<span class="abbrev">Schematron</span>] ISO/IEC JTC 1/SC 34.
<span class="citetitle"><cite>ISO/IEC 19757-3:2006(E) Document Schema Definition
Languages (DSDL) — Part 3: Rule-based validation — Schematron</cite></span>
2006.
</p></div>

<div id="xmlschema-1" class="bibliomixed"><p>[<span class="abbrev">W3C XML Schema: Part 1</span>] 
<a href="http://www.w3.org/TR/xmlschema-1/"><span class="citetitle"><cite>XML Schema Part 1:
Structures Second Edition</cite></span></a>.
Henry S. Thompson, David Beech, Murray Maloney, et. al., editors.
World Wide Web Consortium, 28 October 2004.
</p></div>





<div id="xinclude" class="bibliomixed"><p>[<span class="abbrev">XInclude</span>] 
<a href="http://www.w3.org/TR/xinclude/"><span class="citetitle"><cite>XML Inclusions
(XInclude) Version 1.0 (Second Edition)</cite></span></a>. Jonathan Marsh,
David Orchard, and Daniel Veillard, editors.
W3C Recommendation. 15 November 2006.</p></div>







<div id="xml-serialization" class="bibliomixed"><p>[<span class="abbrev">Serialization</span>] 
<a href="http://www.w3.org/TR/xslt-xquery-serialization/"><span class="citetitle"><cite>XSLT 2.0 and XQuery 1.0 Serialization</cite></span></a>.
 Scott Boag, Michael Kay, Joanne Tong, Norman Walsh, and Henry Zongaro, editors.  W3C Recommendation. 23 January 2007.</p></div>

<div id="rfc1321" class="bibliomixed"><p>[<span class="abbrev">MD5</span>] 
<a href="http://www.ietf.org/rfc/rfc1321.txt"><span class="citetitle"><cite>RFC 1321:
The MD5 Message-Digest Algorithm</cite></span></a>.
R. Rivest. Network Working Group, IETF, April 1992.</p></div>

<div id="rfc1521" class="bibliomixed"><p>[<span class="abbrev">RFC 1521</span>] 
<a href="http://www.ietf.org/rfc/rfc1521.txt"><span class="citetitle"><cite>RFC 1521:
MIME (Multipurpose Internet Mail Extensions) Part One: Mechanisms for
Specifying and Describing the Format of Internet Message
Bodies</cite></span></a>. N. Borenstein, N. Freed, editors. Internet
Engineering Task Force. September, 1993.</p></div>





<div id="rfc2616" class="bibliomixed"><p>[<span class="abbrev">RFC 2616</span>] 
<a href="http://www.ietf.org/rfc/rfc2616.txt"><span class="citetitle"><cite>RFC 2616:
Hypertext Transfer Protocol — HTTP/1.1</cite></span></a>.
R. Fielding, J. Gettys, J. Mogul, et. al., editors. Internet
Engineering Task Force. June, 1999.</p></div>

<div id="rfc2617" class="bibliomixed"><p>[<span class="abbrev">RFC 2617</span>] 
<a href="http://www.ietf.org/rfc/rfc2617.txt"><span class="citetitle"><cite>RFC 2617:
HTTP Authentication: Basic and Digest Access Authentication</cite></span></a>.
J. Franks, P. Hallam-Baker, J. Hostetler, S. Lawrence, P. Leach, A. Luotonen, L. Stewart. June, 1999
.</p></div>











<div id="unicodetr17" class="bibliomixed"><p>[<span class="abbrev">Unicode TR#17</span>] 
<a href="http://unicode.org/reports/tr17/"><span class="citetitle"><cite>Unicode Technical
Report #17: Character Encoding Model</cite></span></a>.
Ken Whistler, Mark Davis, and Asmus Freytag, authors.
The Unicode Consortium. 11 November 2008.</p></div>

<div id="media-types" class="bibliomixed"><p>[<span class="abbrev">IANA Media Types</span>] 
<a href="http://www.iana.org/assignments/media-types/"><span class="citetitle"><cite>IANA MIME Media Types</cite></span></a>. Internet Engineering Task Force.
</p></div>

<div id="tidy" class="bibliomixed"><p>[<span class="abbrev">HTML Tidy</span>] 
<a href="http://tidy.sourceforge.net/"><span class="citetitle"><cite>HTML Tidy Library
Project</cite></span></a>. SourceForge project.
</p></div>

<div id="tagsoup" class="bibliomixed"><p>[<span class="abbrev">TagSoup</span>] 
<a href="http://ccil.org/~cowan/XML/tagsoup/"><span class="citetitle"><cite>TagSoup - Just Keep On Truckin'</cite></span></a>.
John Cowan.
</p></div>

<div id="bib.uuid" class="bibliomixed"><p>[<span class="abbrev">UUID</span>] 
<a href="http://www.itu.int/ITU-T/studygroups/com17/oid.html"><span class="citetitle"><cite>ITU
X.667: Information technology - Open Systems Interconnection -
Procedures for the operation of OSI Registration Authorities:
Generation and registration of Universally Unique Identifiers (UUIDs)
and their use as ASN.1 Object Identifier components</cite></span></a>.
2004.</p></div>

<div id="bib.sha" class="bibliomixed"><p>[<span class="abbrev">SHA1</span>] 
<a href="http://www.itl.nist.gov/fipspubs/fip180-1.htm"><span class="citetitle"><cite>Federal Information Processing Standards Publication 180-1: Secure Hash Standard</cite></span></a>.
1995.</p></div>

</div>
</section>

<section id="informative-references" class="section"><div class="section-titlepage"><h2>2 Informative References</h2></div>


<div id="informative-references.2" class="bibliolist">


<div id="bib.crc" class="bibliomixed"><p>[<span class="abbrev">CRC32</span>] 
“32-Bit Cyclic Redundancy Codes for Internet Applications”,
<span class="citetitle"><cite>The International Conference on Dependable Systems and Networks:
459</cite></span>. <span class="biblioid">10.1109/DSN.2002.1028931</span>.
P. Koopman. June 2002.
</p></div>
</div>
</section>
</article>
</div><script src="http://cdn.docbook.org/release/2.0.20/resources/js/prism.js"></script></body></html>